<!--
                        Licensed to the Apache Software Foundation (ASF) under one or more
                        contributor license agreements.  See the NOTICE file distributed with
                        this work for additional information regarding copyright ownership.
                        The ASF licenses this file to You under the Apache License, Version 2.0
                        (the "License"); you may not use this file except in compliance with
                        the License.  You may obtain a copy of the License at

                        http://www.apache.org/licenses/LICENSE-2.0

                        Unless required by applicable law or agreed to in writing, software
                        distributed under the License is distributed on an "AS IS" BASIS,
                        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                        See the License for the specific language governing permissions and
                        limitations under the License.
                        -->
                        <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<meta name="author" content="Apache NiFi Team">
<title>NiFi System Administrator&#8217;s Guide</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Copyright (C) 2012-2015 Dan Allen, Ryan Waldron and the Asciidoctor Project

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE. */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400";
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9);padding-right: 1px;}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>NiFi System Administrator&#8217;s Guide</h1>
<div class="details">
<span id="author" class="author">Apache NiFi Team</span><br>
<span id="email" class="email"><a href="mailto:dev@nifi.apache.org">dev@nifi.apache.org</a></span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#system-requirements">System Requirements</a></li>
<li><a href="#how-to-install-and-start-nifi">How to install and start NiFi</a></li>
<li><a href="#configuration-best-practices">Configuration Best Practices</a></li>
<li><a href="#security-configuration">Security Configuration</a>
<ul class="sectlevel2">
<li><a href="#tls-generation-toolkit">TLS Generation Toolkit</a></li>
</ul>
</li>
<li><a href="#user_authentication">User Authentication</a>
<ul class="sectlevel2">
<li><a href="#ldap_login_identity_provider">Lightweight Directory Access Protocol (LDAP)</a></li>
<li><a href="#kerberos_login_identity_provider">Kerberos</a></li>
</ul>
</li>
<li><a href="#multi-tenant-authorization">Multi-Tenant Authorization</a>
<ul class="sectlevel2">
<li><a href="#authorizer-configuration">Authorizer Configuration</a></li>
<li><a href="#authorizers-setup">Authorizers.xml Setup</a></li>
<li><a href="#config-users-access-policies">Configuring Users &amp; Access Policies</a></li>
</ul>
</li>
<li><a href="#encryption">Encryption Configuration</a>
<ul class="sectlevel2">
<li><a href="#key-derivation-functions">Key Derivation Functions</a></li>
<li><a href="#salt-and-iv-encoding">Salt and IV Encoding</a></li>
<li><a href="#java-cryptography-extension-jce-limited-strength-jurisdiction-policies">Java Cryptography Extension (JCE) Limited Strength Jurisdiction Policies</a></li>
<li><a href="#allow-insecure-cryptographic-modes">Allow Insecure Cryptographic Modes</a></li>
</ul>
</li>
<li><a href="#encrypted-passwords-in-configuration-files">Encrypted Passwords in Configuration Files</a>
<ul class="sectlevel2">
<li><a href="#encrypt-config_tool">Encrypt-Config Tool</a></li>
<li><a href="#sensitive-property-key-migration">Sensitive Property Key Migration</a></li>
<li><a href="#existing-flow-migration">Existing Flow Migration</a></li>
<li><a href="#encrypt-config_password">Password Key Derivation</a></li>
<li><a href="#encrypt-config_secure_prompt">Secure Prompt</a></li>
</ul>
</li>
<li><a href="#admin-toolkit">Administrative Tools</a>
<ul class="sectlevel2">
<li><a href="#prerequisites-for-running-admin-toolkit-in-a-secure-environment">Prerequisites for Running Admin Toolkit in a Secure Environment</a></li>
<li><a href="#notify">Notify</a></li>
<li><a href="#node-manager">Node Manager</a></li>
</ul>
</li>
<li><a href="#clustering">Clustering Configuration</a></li>
<li><a href="#state_management">State Management</a>
<ul class="sectlevel2">
<li><a href="#state_providers">Configuring State Providers</a></li>
<li><a href="#embedded_zookeeper">Embedded ZooKeeper Server</a></li>
<li><a href="#zk_access_control">ZooKeeper Access Control</a></li>
<li><a href="#securing_zookeeper">Securing ZooKeeper</a></li>
<li><a href="#zookeeper_migrator">ZooKeeper Migrator</a></li>
</ul>
</li>
<li><a href="#bootstrap_properties">Bootstrap Properties</a></li>
<li><a href="#notification_services">Notification Services</a>
<ul class="sectlevel2">
<li><a href="#email-notification-service-br">Email Notification Service<br></a></li>
<li><a href="#http-notification-service-br">HTTP Notification Service<br></a></li>
</ul>
</li>
<li><a href="#kerberos_service">Kerberos Service</a>
<ul class="sectlevel2">
<li><a href="#kerberos_service_notes">Notes</a></li>
</ul>
</li>
<li><a href="#system_properties">System Properties</a>
<ul class="sectlevel2">
<li><a href="#core-properties-br">Core Properties<br></a></li>
<li><a href="#state-management-br">State Management<br></a></li>
<li><a href="#h2-settings">H2 Settings</a></li>
<li><a href="#flowfile-repository">FlowFile Repository</a></li>
<li><a href="#swap-management">Swap Management</a></li>
<li><a href="#content-repository">Content Repository</a></li>
<li><a href="#file-system-content-repository-properties">File System Content Repository Properties</a></li>
<li><a href="#volatile-content-repository-properties">Volatile Content Repository Properties</a></li>
<li><a href="#provenance-repository">Provenance Repository</a></li>
<li><a href="#persistent-provenance-repository-properties">Persistent Provenance Repository Properties</a></li>
<li><a href="#volatile-provenance-repository-properties">Volatile Provenance Repository Properties</a></li>
<li><a href="#write-ahead-provenance-repository-properties">Write Ahead Provenance Repository Properties</a></li>
<li><a href="#encrypted-write-ahead-provenance-repository-properties">Encrypted Write Ahead Provenance Repository Properties</a></li>
<li><a href="#component-status-repository">Component Status Repository</a></li>
<li><a href="#site_to_site_properties">Site to Site Properties</a></li>
<li><a href="#web-properties">Web Properties</a></li>
<li><a href="#security-properties">Security Properties</a></li>
<li><a href="#identity-mapping-properties">Identity Mapping Properties</a></li>
<li><a href="#cluster-common-properties">Cluster Common Properties</a></li>
<li><a href="#cluster-node-properties">Cluster Node Properties</a></li>
<li><a href="#claim_management">Claim Management</a></li>
<li><a href="#zookeeper-properties">ZooKeeper Properties</a></li>
<li><a href="#kerberos_properties">Kerberos Properties</a></li>
<li><a href="#custom_properties">Custom Properties</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="system-requirements"><a class="anchor" href="#system-requirements"></a>System Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache NiFi can run on something as simple as a laptop, but it can also be clustered across many enterprise-class servers. Therefore, the amount of hardware and memory needed will depend on the size and nature of the dataflow involved. The data is stored on disk while NiFi is processing it. So NiFi needs to have sufficient disk space allocated for its various repositories, particularly the content repository, flowfile repository, and provenance repository (see the <a href="#system_properties">System Properties</a> section for more information about these repositories). NiFi has the following minimum system requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Requires Java 8 or newer</p>
</li>
<li>
<p>Supported Operating Systems:</p>
<div class="ulist">
<ul>
<li>
<p>Linux</p>
</li>
<li>
<p>Unix</p>
</li>
<li>
<p>Windows</p>
</li>
<li>
<p>Mac OS X</p>
</li>
</ul>
</div>
</li>
<li>
<p>Supported Web Browsers:</p>
<div class="ulist">
<ul>
<li>
<p>Microsoft Edge:  Current &amp; (Current - 1)</p>
</li>
<li>
<p>Mozilla FireFox: Current &amp; (Current - 1)</p>
</li>
<li>
<p>Google Chrome:  Current &amp; (Current - 1)</p>
</li>
<li>
<p>Safari:  Current &amp; (Current - 1)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note</strong> Under sustained and extremely high throughput the CodeCache settings may need to be tuned to avoid sudden performance loss.  See the <a href="#bootstrap_properties">Bootstrap Properties</a> section for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-install-and-start-nifi"><a class="anchor" href="#how-to-install-and-start-nifi"></a>How to install and start NiFi</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Linux/Unix/OS X</p>
<div class="ulist">
<ul>
<li>
<p>Decompress and untar into desired installation directory</p>
</li>
<li>
<p>Make any desired edits in files found under &lt;installdir&gt;/conf</p>
<div class="ulist">
<ul>
<li>
<p>At a minimum, we recommend editing the <em>nifi.properties</em> file and entering a password for the nifi.sensitive.props.key (see <a href="#system_properties">System Properties</a> below)</p>
</li>
</ul>
</div>
</li>
<li>
<p>From the &lt;installdir&gt;/bin directory, execute the following commands by typing ./nifi.sh &lt;command&gt;:</p>
<div class="ulist">
<ul>
<li>
<p>start: starts NiFi in the background</p>
</li>
<li>
<p>stop: stops NiFi that is running in the background</p>
</li>
<li>
<p>status: provides the current status of NiFi</p>
</li>
<li>
<p>run: runs NiFi in the foreground and waits for a Ctrl-C to initiate shutdown of NiFi</p>
</li>
<li>
<p>install: installs NiFi as a service that can then be controlled via</p>
<div class="ulist">
<ul>
<li>
<p>service nifi start</p>
</li>
<li>
<p>service nifi stop</p>
</li>
<li>
<p>service nifi status</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Windows</p>
<div class="ulist">
<ul>
<li>
<p>Decompress into the desired installation directory</p>
</li>
<li>
<p>Make any desired edits in the files found under &lt;installdir&gt;/conf</p>
<div class="ulist">
<ul>
<li>
<p>At a minimum, we recommend editing the <em>nifi.properties</em> file and entering a password for the nifi.sensitive.props.key (see <a href="#system_properties">System Properties</a> below)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Navigate to the &lt;installdir&gt;/bin directory</p>
</li>
<li>
<p>Double-click run-nifi.bat. This runs NiFi in the foreground and waits for a Ctrl-C to initiate shutdown of NiFi</p>
</li>
<li>
<p>To see the current status of NiFi, double-click status-nifi.bat</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When NiFi first starts up, the following files and directories are created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>content_repository</p>
</li>
<li>
<p>database_repository</p>
</li>
<li>
<p>flowfile_repository</p>
</li>
<li>
<p>provenance_repository</p>
</li>
<li>
<p>work directory</p>
</li>
<li>
<p>logs directory</p>
</li>
<li>
<p>Within the conf directory, the <em>flow.xml.gz</em> file and the templates directory are created</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See the <a href="#system_properties">System Properties</a> section of this guide for more information about configuring NiFi repositories and configuration files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-best-practices"><a class="anchor" href="#configuration-best-practices"></a>Configuration Best Practices</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are running on Linux, consider these best practices. Typical Linux defaults are not necessarily well tuned for the needs of an IO intensive application like NiFi.  For all of these areas, your distribution&#8217;s requirements may vary.  Use these sections as advice, but
consult your distribution-specific documentation for how best to achieve these recommendations.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Maximum File Handles</dt>
<dd>
<p>NiFi will at any one time potentially have a very large number of file handles open.  Increase the limits by
editing <em>/etc/security/limits.conf</em> to add
something like</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>*  hard  nofile  50000
*  soft  nofile  50000</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Maximum Forked Processes</dt>
<dd>
<p>NiFi may be configured to generate a significant number of threads.  To increase the allowable number edit <em>/etc/security/limits.conf</em></p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>*  hard  nproc  10000
*  soft  nproc  10000</pre>
</div>
</div>
<div class="paragraph">
<p>And your distribution may require an edit to /etc/security/limits.d/90-nproc.conf by adding</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*  soft  nproc  10000</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Increase the number of TCP socket ports available</dt>
<dd>
<p>This is particularly important if your flow will be setting up and tearing
down a large number of sockets in small period of time.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo sysctl -w net.ipv4.ip_local_port_range="10000 65000"</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Set how long sockets stay in a TIMED_WAIT state when closed</dt>
<dd>
<p>You don&#8217;t want your sockets to sit and linger too long given that you want to be
able to quickly setup and teardown new sockets.  It is a good idea to read more about
it but to adjust do something like</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo sysctl -w net.ipv4.netfilter.ip_conntrack_tcp_timeout_time_wait="1"</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Tell Linux you never want NiFi to swap</dt>
<dd>
<p>Swapping is fantastic for some applications.  It isn&#8217;t good for something like
NiFi that always wants to be running.  To tell Linux you&#8217;d like swapping off you
can edit <em>/etc/sysctl.conf</em> to add the following line</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>vm.swappiness = 0</pre>
</div>
</div>
<div class="paragraph">
<p>For the partitions handling the various NiFi repos turn off things like <em>atime</em>.
Doing so can cause a surprising bump in throughput.  Edit the <em>/etc/fstab</em> file
and for the partition(s) of interest add the <em>noatime</em> option.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-configuration"><a class="anchor" href="#security-configuration"></a>Security Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi provides several different configuration options for security purposes. The most important properties are those under the
"security properties" heading in the <em>nifi.properties</em> file. In order to run securely, the following properties must be set:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.needClientAuth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to specify that connecting clients must authenticate themselves. This property is used by the NiFi cluster protocol to indicate that nodes in the cluster will be authenticated and must have certificates that are trusted by the Truststores.</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.keystore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filename of the Keystore that contains the server&#8217;s private key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.keystoreType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of Keystore. Must be either <code>PKCS12</code> or <code>JKS</code>.  JKS is the preferred type, PKCS12 files will be loaded with BouncyCastle provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.keystorePasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Keystore.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.keyPasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the certificate in the Keystore. If not set, the value of <code>nifi.security.keystorePasswd</code> will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.truststore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filename of the Truststore that will be used to authorize those connecting to NiFi.  A secured instance with no Truststore will refuse all incoming connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.truststoreType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the Truststore. Must be either <code>PKCS12</code> or <code>JKS</code>.  JKS is the preferred type, PKCS12 files will be loaded with BouncyCastle provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>nifi.security.truststorePasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Truststore.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Once the above properties have been configured, we can enable the User Interface to be accessed over HTTPS instead of HTTP. This is accomplished
by setting the <code>nifi.web.https.host</code> and <code>nifi.web.https.port</code> properties. The <code>nifi.web.https.host</code> property indicates which hostname the server
should run on. If it is desired that the HTTPS interface be accessible from all network interfaces, a value of <code>0.0.0.0</code> should be used.  To allow
admins to configure the application to run only on specific network interfaces, <code>nifi.web.http.network.interface*</code> or <code>nifi.web.https.network.interface*</code>
properties can be specified.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important when enabling HTTPS that the <code>nifi.web.http.port</code> property be unset.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Similar to <code>nifi.security.needClientAuth</code>, the web server can be configured to require certificate based client authentication for users accessing
the User Interface. In order to do this it must be configured to not support username/password authentication using  <a href="#ldap_login_identity_provider">Lightweight Directory Access Protocol (LDAP)</a> or <a href="#kerberos_login_identity_provider">Kerberos</a>. Either of these options
will configure the web server to WANT certificate based client authentication. This will allow it to support users with certificates and those without
that may be logging in with their credentials or those accessing anonymously. If username/password authentication and anonymous access are not configured,
the web server will REQUIRE certificate based client authentication. See <a href="#user_authentication">User Authentication</a> for more details.</p>
</div>
<div class="paragraph">
<p>Now that the User Interface has been secured, we can easily secure Site-to-Site connections and inner-cluster communications, as well. This is
accomplished by setting the <code>nifi.remote.input.secure</code> and <code>nifi.cluster.protocol.is.secure</code> properties, respectively, to <code>true</code>.</p>
</div>
<div class="sect2">
<h3 id="tls-generation-toolkit"><a class="anchor" href="#tls-generation-toolkit"></a>TLS Generation Toolkit</h3>
<div class="paragraph">
<p>In order to facilitate the secure setup of NiFi, you can use the <code>tls-toolkit</code> command line utility to automatically generate the required keystores, truststore, and relevant configuration files. This is especially useful for securing multiple NiFi nodes, which can be a tedious and error-prone process.</p>
</div>
<div class="paragraph">
<p>Note: JKS keystores and truststores are recommended for NiFi.  This tool allows the specification of other keystore types on the command line but will ignore a type of PKCS12 for use as the truststore because that format has some compatibility issues between BouncyCastle and Oracle implementations.</p>
</div>
<div class="paragraph">
<p>The <code>tls-toolkit</code> command line tool has two primary modes of operation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Standalone&#8201;&#8212;&#8201;generates the certificate authority, keystores, truststores, and nifi.properties files in one command.</p>
</li>
<li>
<p>Client/Server mode&#8201;&#8212;&#8201;uses a Certificate Authority Server that accepts Certificate Signing Requests from clients, signs them, and sends the resulting certificates back.  Both client and server validate the other’s identity through a shared secret.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="standalone"><a class="anchor" href="#standalone"></a>Standalone</h4>
<div class="paragraph">
<p>Standalone mode is invoked by running <code>./bin/tls-toolkit.sh standalone -h</code> which prints the usage information along with descriptions of options that can be specified.</p>
</div>
<div class="paragraph">
<p>The most common options to specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-n,--hostnames</code>          The comma-separated list of hostnames that you’d like to generate certificates for.  It can be specified multiple times.  Range and instance patterns are supported. See below for details.</p>
</li>
<li>
<p><code>-C,--clientCertDn</code>       The DN that you&#8217;d like to generate a client certificate for.  It can be specified multiple times.</p>
</li>
<li>
<p><code>-f,--nifiPropertiesFile</code> The base <em>nifi.properties</em> file that the tool will update for each host.</p>
</li>
<li>
<p><code>-o,--outputDirectory</code>    The directory to use for the resulting Certificate Authority files and NiFi configurations.  A subdirectory will be made for each host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hostname Patterns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Square brackets can be used in order to easily specify a range of hostnames. Example: [01-20]</p>
</li>
<li>
<p>Parentheses can be used in order to specify that more than one NiFi instance will run on the given host(s). Example: (5)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p>Create 4 sets of keystore, truststore, nifi.properties for localhost along with a client certificate with the given DN:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/tls-toolkit.sh standalone -n 'localhost(4)' -C 'CN=username,OU=NIFI'</pre>
</div>
</div>
<div class="paragraph">
<p>Create keystore, truststore, nifi.properties for 10 NiFi hostnames in each of 4 subdomains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/tls-toolkit.sh standalone -n 'nifi[01-10].subdomain[1-4].domain'</pre>
</div>
</div>
<div class="paragraph">
<p>Create 2 sets of keystore, truststore, nifi.properties for 10 NiFi hostnames in each of 4 subdomains along with a client certificate with the given DN:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>bin/tls-toolkit.sh standalone -n 'nifi[01-10].subdomain[1-4].domain(2)' -C 'CN=username,OU=NIFI'</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="client-server"><a class="anchor" href="#client-server"></a>Client/Server</h4>
<div class="paragraph">
<p>Client/Server mode relies on a long-running Certificate Authority (CA) to issue certificates.  The CA can be stopped when you’re not bringing nodes online.</p>
</div>
<div class="sect4">
<h5 id="server"><a class="anchor" href="#server"></a>Server</h5>
<div class="paragraph">
<p>The CA server is invoked by running <code>./bin/tls-toolkit server -h</code> prints the usage information along with descriptions of options that can be specified.</p>
</div>
<div class="paragraph">
<p>The most common options to specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-f,--configJson</code>        The location of the json config (written after first run)</p>
</li>
<li>
<p><code>-F,--useConfigJson</code>     Loads all relevant configuration from the config json (configJson is the only other argument necessary)</p>
</li>
<li>
<p><code>-t,--token</code>             The token used to prevent man in the middle attacks (this should be a long, random value and needs to be known when invoking the client)</p>
</li>
<li>
<p><code>-D,--dn</code>                The DN for the CA</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="client"><a class="anchor" href="#client"></a>Client</h5>
<div class="paragraph">
<p>The client can be used to request new Certificates from the CA.  The client utility generates a keypair and Certificate Signing Request (CSR) and sends the CSR to the Certificate Authority.  The client is invoked by running <code>./bin/tls-toolkit.sh client -h</code> which prints the usage information along with descriptions of options that can be specified.</p>
</div>
<div class="paragraph">
<p>The most common options to specify are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-f,--configJson</code>                   The json config file</p>
</li>
<li>
<p><code>-c,--certificateAuthorityHostname</code>  The hostname of the CA</p>
</li>
<li>
<p><code>-D,--DN</code>                            The DN for the CSR (and Certificate)</p>
</li>
<li>
<p><code>-t,--token</code>                         The token used to prevent man in the middle attacks (this should be a long, random value and needs to be the same one used to start the CA server)</p>
</li>
<li>
<p><code>-T,--keyStoreType</code>                  The type of keystore to create (leave default for NiFi nodes, specify PKCS12 to create client cert)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After running the client you will have the CA’s certificate, a keystore, a truststore, and a config.json with information about them as well as their passwords.</p>
</div>
<div class="paragraph">
<p>For a client certificate that can be easily imported into the browser, specify: <code>-T PKCS12</code></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user_authentication"><a class="anchor" href="#user_authentication"></a>User Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi supports user authentication via client certificates or via username/password. Username/password authentication is performed by a <em>Login Identity
Provider</em>. The Login Identity Provider is a pluggable mechanism for authenticating users via their username/password. Which Login Identity Provider
to use is configured in two properties in the <em>nifi.properties</em> file.</p>
</div>
<div class="paragraph">
<p>The <code>nifi.login.identity.provider.configuration.file</code> property specifies the configuration file for Login Identity Providers.
The <code>nifi.security.user.login.identity.provider</code> property indicates which of the configured Login Identity Provider should be
used. If this property is not configured, NiFi will not support username/password authentication and will require client
certificates for authenticating users over HTTPS. By default, this property is not configured meaning that username/password must be explicitly enabled.</p>
</div>
<div class="paragraph">
<p>A secured instance of NiFi cannot be accessed anonymously unless configured to use an LDAP or Kerberos Login Identity Provider, which in turn must be configured to explicitly allow anonymous access. Anonymous access is not currently possible by the default FileAuthorizer (see <a href="#authorizer-configuration">Authorizer Configuration</a>), but is a future effort (<a href="https://issues.apache.org/jira/browse/NIFI-2730">NIFI-2730</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
NiFi does not perform user authentication over HTTP. Using HTTP, all users will be granted all roles.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="ldap_login_identity_provider"><a class="anchor" href="#ldap_login_identity_provider"></a>Lightweight Directory Access Protocol (LDAP)</h3>
<div class="paragraph">
<p>Below is an example and description of configuring a Login Identity Provider that integrates with a Directory Server to authenticate users.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;provider&gt;
    &lt;identifier&gt;ldap-provider&lt;/identifier&gt;
    &lt;class&gt;org.apache.nifi.ldap.LdapProvider&lt;/class&gt;
    &lt;property name="Authentication Strategy"&gt;START_TLS&lt;/property&gt;

    &lt;property name="Manager DN"&gt;&lt;/property&gt;
    &lt;property name="Manager Password"&gt;&lt;/property&gt;

    &lt;property name="TLS - Keystore"&gt;&lt;/property&gt;
    &lt;property name="TLS - Keystore Password"&gt;&lt;/property&gt;
    &lt;property name="TLS - Keystore Type"&gt;&lt;/property&gt;
    &lt;property name="TLS - Truststore"&gt;&lt;/property&gt;
    &lt;property name="TLS - Truststore Password"&gt;&lt;/property&gt;
    &lt;property name="TLS - Truststore Type"&gt;&lt;/property&gt;
    &lt;property name="TLS - Client Auth"&gt;&lt;/property&gt;
    &lt;property name="TLS - Protocol"&gt;&lt;/property&gt;
    &lt;property name="TLS - Shutdown Gracefully"&gt;&lt;/property&gt;

    &lt;property name="Referral Strategy"&gt;FOLLOW&lt;/property&gt;
    &lt;property name="Connect Timeout"&gt;10 secs&lt;/property&gt;
    &lt;property name="Read Timeout"&gt;10 secs&lt;/property&gt;

    &lt;property name="Url"&gt;&lt;/property&gt;
    &lt;property name="User Search Base"&gt;&lt;/property&gt;
    &lt;property name="User Search Filter"&gt;&lt;/property&gt;

    &lt;property name="Identity Strategy"&gt;USE_DN&lt;/property&gt;
    &lt;property name="Authentication Expiration"&gt;12 hours&lt;/property&gt;
&lt;/provider&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, username/password authentication can be enabled by referencing this provider in <em>nifi.properties</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nifi.security.user.login.identity.provider=ldap-provider</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authentication Expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The duration of how long the user authentication is valid for. If the user never logs out, they will be required to log back in following this duration.</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authentication Strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How the connection to the LDAP server is authenticated. Possible values are ANONYMOUS, SIMPLE, LDAPS, or START_TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Manager DN</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The DN of the manager that is used to bind to the LDAP server to search for users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Manager Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the manager that is used to bind to the LDAP server to search for users.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Keystore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the Keystore that is used when connecting to LDAP using LDAPS or START_TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Keystore Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for the Keystore that is used when connecting to LDAP using LDAPS or START_TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Keystore Type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the Keystore that is used when connecting to LDAP using LDAPS or START_TLS (i.e. JKS or PKCS12).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Truststore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the Truststore that is used when connecting to LDAP using LDAPS or START_TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Truststore Password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for the Truststore that is used when connecting to LDAP using LDAPS or START_TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Truststore Type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the Truststore that is used when connecting to LDAP using LDAPS or START_TLS (i.e. JKS or PKCS12).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Client Auth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client authentication policy when connecting to LDAP using LDAPS or START_TLS. Possible values are REQUIRED, WANT, NONE.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Protocol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol to use when connecting to LDAP using LDAPS or START_TLS. (i.e. TLS, TLSv1.1, TLSv1.2, etc).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TLS - Shutdown Gracefully</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the TLS should be shut down gracefully before the target context is closed. Defaults to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Referral Strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy for handling referrals. Possible values are FOLLOW, IGNORE, THROW.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Connect Timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of connect timeout. (i.e. 10 secs).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Read Timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of read timeout. (i.e. 10 secs).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Space-separated list of URLs of the LDAP servers (i.e. ldap://&lt;hostname&gt;:&lt;port&gt;).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>User Search Base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base DN for searching for users (i.e. CN=Users,DC=example,DC=com).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>User Search Filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filter for searching for users against the <em>User Search Base</em>. (i.e. sAMAccountName={0}). The user specified name is inserted into <em>{0}</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Identity Strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strategy to identify users. Possible values are USE_DN and USE_USERNAME. The default functionality if this property is missing is USE_DN in order to retain backward
compatibility. USE_DN will use the full DN of the user entry if possible. USE_USERNAME will use the username the user logged in with.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="kerberos_login_identity_provider"><a class="anchor" href="#kerberos_login_identity_provider"></a>Kerberos</h3>
<div class="paragraph">
<p>Below is an example and description of configuring a Login Identity Provider that integrates with a Kerberos Key Distribution Center (KDC) to authenticate users.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;provider&gt;
    &lt;identifier&gt;kerberos-provider&lt;/identifier&gt;
    &lt;class&gt;org.apache.nifi.kerberos.KerberosProvider&lt;/class&gt;
    &lt;property name="Default Realm"&gt;NIFI.APACHE.ORG&lt;/property&gt;
    &lt;property name="Kerberos Config File"&gt;/etc/krb5.conf&lt;/property&gt;
    &lt;property name="Authentication Expiration"&gt;12 hours&lt;/property&gt;
&lt;/provider&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, username/password authentication can be enabled by referencing this provider in <em>nifi.properties</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nifi.security.user.login.identity.provider=kerberos-provider</pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tfoot>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Authentication Expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The duration of how long the user authentication is valid for. If the user never logs out, they will be required to log back in following this duration.</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Default Realm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default realm to provide when user enters incomplete user principal (i.e. NIFI.APACHE.ORG).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Kerberos Config File</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Absolute path to Kerberos client configuration file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See also <a href="#kerberos_service">Kerberos Service</a> to allow single sign-on access via client Kerberos tickets.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multi-tenant-authorization"><a class="anchor" href="#multi-tenant-authorization"></a>Multi-Tenant Authorization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you have configured NiFi to run securely and with an authentication mechanism, you must configure who has access to the system, and the level of their access.
You can do this using <em>multi-tenant authorization</em>. Multi-tenant authorization enables multiple groups of users (tenants) to command, control, and observe different
parts of the dataflow, with varying levels of authorization. When an authenticated user attempts to view or modify a NiFi resource, the system checks whether the
user has privileges to perform that action. These privileges are defined by policies that you can apply system-wide or to individual components.</p>
</div>
<div class="sect2">
<h3 id="authorizer-configuration"><a class="anchor" href="#authorizer-configuration"></a>Authorizer Configuration</h3>
<div class="paragraph">
<p>An <em>authorizer</em> grants users the privileges to manage users and policies by creating preliminary authorizations at startup.</p>
</div>
<div class="paragraph">
<p>Authorizers are configured using two properties in the <em>nifi.properties</em> file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>nifi.authorizer.configuration.file</code> property specifies the configuration file where authorizers are defined.  By default, the <em>authorizers.xml</em> file located in the root installation conf directory is selected.</p>
</li>
<li>
<p>The <code>nifi.security.user.authorizer</code> property indicates which of the configured authorizers in the <em>authorizers.xml</em> file to use.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="authorizers-setup"><a class="anchor" href="#authorizers-setup"></a>Authorizers.xml Setup</h3>
<div class="paragraph">
<p>The <em>authorizers.xml</em> file is used to define and configure available authorizers.  The default authorizer is the FileAuthorizer, however, you can develop additional authorizers as extensions.  The FileAuthorizer has the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorizations File - The file where the FileAuthorizer stores policies.  By default, the <em>authorizations.xml</em> in the <em>conf</em> directory is chosen.</p>
</li>
<li>
<p>Users File - The file where the FileAuthorizer stores users and groups.  By default, the <em>users.xml</em> in the <em>conf</em> directory is chosen.</p>
</li>
<li>
<p>Initial Admin Identity - The identity of an initial admin user that is granted access to the UI and given the ability to create additional users, groups, and policies. This property is only used when there are no other users, groups, and policies defined.</p>
</li>
<li>
<p>Legacy Authorized Users File - The full path to an existing authorized-users.xml that is automatically converted to the multi-tenant authorization model.  This property is only used when there  are no other users, groups, and policies defined.</p>
</li>
<li>
<p>Node Identity - The identity of a NiFi cluster node. When clustered, a property for each node should be defined, so that every node knows about every other node. If not clustered, these properties can be ignored.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="initial-admin-identity"><a class="anchor" href="#initial-admin-identity"></a>Initial Admin Identity  (New NiFi Instance)</h4>
<div class="paragraph">
<p>If you are setting up a secured NiFi instance for the first time, you must manually designate an “Initial Admin Identity” in the <em>authorizers.xml</em> file.  This initial admin user is granted access to the UI and given the ability to create additional users, groups, and policies. The value of this property could be a DN (when using certificates or LDAP) or a Kerberos principal.  If you are the NiFi administrator, add yourself as the “Initial Admin Identity”.</p>
</div>
<div class="paragraph">
<p>Here is an example LDAP entry using the name John Smith:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;authorizer&gt;
        &lt;identifier&gt;file-provider&lt;/identifier&gt;
        &lt;class&gt;org.apache.nifi.authorization.FileAuthorizer&lt;/class&gt;
        &lt;property name="Authorizations File"&gt;./conf/authorizations.xml&lt;/property&gt;
        &lt;property name="Users File"&gt;./conf/users.xml&lt;/property&gt;
        &lt;property name="Initial Admin Identity"&gt;cn=John Smith,ou=people,dc=example,dc=com&lt;/property&gt;
        &lt;property name="Legacy Authorized Users File"&gt;&lt;/property&gt;
        &lt;!--
        &lt;property name="Node Identity 1"&gt;&lt;/property&gt;
        &lt;property name="Node Identity 2"&gt;&lt;/property&gt;
        --&gt;
    &lt;/authorizer&gt;
&lt;/authorizers&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example Kerberos entry using the name John Smith and realm <code>NIFI.APACHE.ORG</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;authorizer&gt;
        &lt;identifier&gt;file-provider&lt;/identifier&gt;
        &lt;class&gt;org.apache.nifi.authorization.FileAuthorizer&lt;/class&gt;
        &lt;property name="Authorizations File"&gt;./conf/authorizations.xml&lt;/property&gt;
        &lt;property name="Users File"&gt;./conf/users.xml&lt;/property&gt;
        &lt;property name="Initial Admin Identity"&gt;johnsmith@NIFI.APACHE.ORG&lt;/property&gt;
        &lt;property name="Legacy Authorized Users File"&gt;&lt;/property&gt;
        &lt;!--
        &lt;property name="Node Identity 1"&gt;&lt;/property&gt;
        &lt;property name="Node Identity 2"&gt;&lt;/property&gt;
        --&gt;
    &lt;/authorizer&gt;
&lt;/authorizers&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>After you have edited and saved the <em>authorizers.xml</em> file, restart NiFi.  The “Initial Admin Identity” user and administrative policies are added to the <em>users.xml</em> and <em>authorizations.xml</em> files during restart. Once NiFi starts, the “Initial Admin Identity” user is able to access the UI and begin managing users, groups, and policies.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a brand new secure flow, providing the "Initial Admin Identity" gives that user access to get into the UI and to manage users, groups and policies.  But if that user wants to start modifying the flow, they need to grant themselves policies for the root process group. The system is unable to do this automatically because in a new flow the UUID of the root process group is not permanent until the flow.xml.gz is generated.  If the NiFi instance is an upgrade from an existing flow.xml.gz or a 1.x instance going from unsecure to secure, then the "Initial Admin Identity" user is automatically given the privileges to modify the flow.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="legacy-authorized-users"><a class="anchor" href="#legacy-authorized-users"></a>Legacy Authorized Users (NiFi Instance Upgrade)</h4>
<div class="paragraph">
<p>If you are upgrading from a 0.x NiFi instance, you can convert your previously configured users and roles to the multi-tenant authorization model.  In the <em>authorizers.xml</em> file, specify the location of your existing <em>authorized-users.xml</em> file in the “Legacy Authorized Users File” property.</p>
</div>
<div class="paragraph">
<p>Here is an example entry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;authorizers&gt;
    &lt;authorizer&gt;
        &lt;identifier&gt;file-provider&lt;/identifier&gt;
        &lt;class&gt;org.apache.nifi.authorization.FileAuthorizer&lt;/class&gt;
        &lt;property name="Authorizations File"&gt;./conf/authorizations.xml&lt;/property&gt;
        &lt;property name="Users File"&gt;./conf/users.xml&lt;/property&gt;
        &lt;property name="Initial Admin Identity"&gt;&lt;/property&gt;
        &lt;property name="Legacy Authorized Users File"&gt;/Users/johnsmith/config_files/authorized-users.xml&lt;/property&gt;
    &lt;/authorizer&gt;
&lt;/authorizers&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>After you have edited and saved the <em>authorizers.xml</em> file, restart NiFi. Users and roles from the <em>authorized-users.xml</em> file are converted and added as identities and policies in the <em>users.xml</em> and <em>authorizations.xml</em> files.  Once the application starts, users who previously had a legacy Administrator role can access the UI and begin managing users, groups, and policies.</p>
</div>
<div class="paragraph">
<p>The following tables summarize the global and component policies assigned to each legacy role if the NiFi instance has an existing <em>flow.xml.gz</em>:</p>
</div>
<div class="sect4">
<h5 id="global-access-policies"><a class="anchor" href="#global-access-policies"></a>Global Access Policies</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-center valign-top">Admin</th>
<th class="tableblock halign-center valign-top">DFM</th>
<th class="tableblock halign-center valign-top">Monitor</th>
<th class="tableblock halign-center valign-top">Provenance</th>
<th class="tableblock halign-center valign-top">NiFi</th>
<th class="tableblock halign-center valign-top">Proxy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>view the UI</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access the controller - view</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access the controller - modify</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>query provenance</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access restricted components</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access all policies - view</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access all policies - modify</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access users/user groups - view</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access users/user groups - modify</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>retrieve site-to-site details</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>view system diagnostics</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>proxy user requests</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>access counters</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="component-access-policies-on-the-root-process-group"><a class="anchor" href="#component-access-policies-on-the-root-process-group"></a>Component Access Policies on the Root Process Group</h5>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
<col style="width: 14%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-right valign-top"></th>
<th class="tableblock halign-center valign-top">Admin</th>
<th class="tableblock halign-center valign-top">DFM</th>
<th class="tableblock halign-center valign-top">Monitor</th>
<th class="tableblock halign-center valign-top">Provenance</th>
<th class="tableblock halign-center valign-top">NiFi</th>
<th class="tableblock halign-center valign-top">Proxy</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>view the component</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>modify the component</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>view the data</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>modify the data</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>*</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For details on the individual policies in the table, see <a href="#access-policies">Access Policies</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
NiFi fails to restart if values exist for both the “Initial Admin Identity” and “Legacy Authorized Users File” properties.  You can specify only one of these values to initialize authorizations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not manually edit the <em>authorizations.xml</em> file. Create authorizations only during initial setup and afterwards using the NiFi UI.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cluster-node-identities"><a class="anchor" href="#cluster-node-identities"></a>Cluster Node Identities</h4>
<div class="paragraph">
<p>If you are running NiFi in a clustered environment, you must specify the identities for each node.  The authorization policies required for the nodes to communicate are created during startup.</p>
</div>
<div class="paragraph">
<p>For example, if you are setting up a 2 node cluster with the following DNs for each node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cn=nifi-1,ou=people,dc=example,dc=com
cn=nifi-2,ou=people,dc=example,dc=com</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;authorizer&gt;
        &lt;identifier&gt;file-provider&lt;/identifier&gt;
        &lt;class&gt;org.apache.nifi.authorization.FileAuthorizer&lt;/class&gt;
        &lt;property name="Authorizations File"&gt;./conf/authorizations.xml&lt;/property&gt;
        &lt;property name="Users File"&gt;./conf/users.xml&lt;/property&gt;
        &lt;property name="Initial Admin Identity"&gt;johnsmith@NIFI.APACHE.ORG&lt;/property&gt;
        &lt;property name="Legacy Authorized Users File"&gt;&lt;/property&gt;
        &lt;property name="Node Identity 1"&gt;cn=nifi-1,ou=people,dc=example,dc=com&lt;/property&gt;
        &lt;property name="Node Identity 2"&gt;cn=nifi-2,ou=people,dc=example,dc=com&lt;/property&gt;
    &lt;/authorizer&gt;
&lt;/authorizers&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a cluster, all nodes must have the same <em>authorizations.xml</em> and <em>users.xml</em>.   The only exception is if a node has empty <em>authorizations.xml</em> and <em>user.xml</em> files prior to joining the cluster.  In this scenario, the node inherits them from the cluster during startup.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that initial authorizations have been created, additional users, groups and authorizations can be created and managed in the NiFi UI.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="config-users-access-policies"><a class="anchor" href="#config-users-access-policies"></a>Configuring Users &amp; Access Policies</h3>
<div class="paragraph">
<p>This section describes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How to create users and groups</p>
</li>
<li>
<p>How access policies are used to define authorizations</p>
</li>
<li>
<p>How to view policies that are set on a user</p>
</li>
<li>
<p>How to configure access policies by walking through specific examples</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instructions requiring interaction with the UI assume the application is being accessed by User1, a user with administrator privileges, such as the “Initial Admin Identity” user or a converted legacy admin user (see <a href="#authorizers-setup">Authorizers.xml Setup</a>).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-users-groups"><a class="anchor" href="#creating-users-groups"></a>Creating Users and Groups</h4>
<div class="paragraph">
<p>From the UI, select “Users” from the Global Menu.  This opens a dialog to create and manage users and groups.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/nifi-users-dialog.png" alt="NiFi Users Dialog"></span></p>
</div>
<div class="paragraph">
<p>Click the Add icon (<span class="image"><img src="./images/iconAddUser.png" alt="Add User Icon"></span>).  To create a user, enter the <em>Identity</em> information relevant to the authentication method chosen to secure your NiFi instance.  Click OK.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user-creation-dialog.png" alt="User Creation Dialog"></span></p>
</div>
<div class="paragraph">
<p>To create a group, select the “Group” radio button, enter the name of the group and select the users to be included in the group.  Click OK.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/group-creation-dialog.png" alt="Group Creation Dialog"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="access-policies"><a class="anchor" href="#access-policies"></a>Access Policies</h4>
<div class="paragraph">
<p>You can manage the ability for users and groups to view or modify NiFi resources using <em>access policies</em>.  There are two types of access policies that can be applied to a resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View&#8201;&#8212;&#8201; If a view policy is created for a resource, only the users or groups that are added to that policy are able to see the details of that resource.</p>
</li>
<li>
<p>Modify&#8201;&#8212;&#8201;If a resource has a modify policy, only the users or groups that are added to that policy can change the configuration of that resource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can create and apply access policies on both global and component levels.</p>
</div>
<div class="sect4">
<h5 id="global-access-policies"><a class="anchor" href="#global-access-policies"></a>Global Access Policies</h5>
<div class="paragraph">
<p>Global access policies govern the following system level authorizations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Privilege</th>
<th class="tableblock halign-left valign-top">Global Menu Selection</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view the UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow users to view the UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access the controller</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view/modify the controller including Reporting Tasks, Controller Services, and Nodes in the Cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controller Settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">query provenance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to submit a Provenance Search and request Event Lineage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Provenance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access restricted components</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to create/modify restricted components assuming otherwise sufficient permissions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access all policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view/modify the policies for all components</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policies</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access users/user groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view/modify the users and user groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retrieve site-to-site details</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows other NiFi instances to retrieve Site-To-Site details</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view system diagnostics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view System Diagnostics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Summary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy user requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows proxy machines to send requests on the behalf of others</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">access counters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view/modify Counters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counters</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="component-level-access-policies"><a class="anchor" href="#component-level-access-policies"></a>Component Level Access Policies</h5>
<div class="paragraph">
<p>Component level access policies govern the following component level authorizations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Privilege</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view the component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view component configuration details</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modify the component</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to modify component configuration details</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view the data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user to view metadata and content for this component through provenance data and flowfile queues in outbound connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modify the data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user to empty flowfile queues in outbound connections and submit replays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">view the policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to view the list of users who can view/modify a component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modify the policies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to modify the list of users who can view/modify a component</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive data via site-to-site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a port to receive data from NiFi instances</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send data via site-to-site</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a port to send data from NiFi instances</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can apply access policies to all component types except connections.  Connection authorizations are inferred by the individual access policies on the source and destination components of the connection, as well as the access policy of the process group containing the components.  This is discussed in more detail in the <a href="#creating-a-connection">Creating a Connection</a> and <a href="#editing-a-connection">Editing a Connection</a> examples below.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to access List Queue or Delete Queue for a connection, a user requires permission to the "view the data" and "modify the data" policies on the component. In a clustered environment, all nodes must be be added to these policies as well, as a user request could be replicated through any node in the cluster.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="access-policy-inheritance"><a class="anchor" href="#access-policy-inheritance"></a>Access Policy Inheritance</h5>
<div class="paragraph">
<p>An administrator does not need to manually create policies for every component in the dataflow.  To reduce the amount of time admins spend on authorization management, policies are inherited from parent resource to child resource.  For example, if a user is given access to view and modify a process group, that user can also view and modify the components in the process group.  Policy inheritance enables an administrator to assign policies at one time and have the policies apply throughout the entire dataflow.</p>
</div>
<div class="paragraph">
<p>You can override an inherited policy (as described in the <a href="#moving-a-processor">Moving a Processor</a> example below).  Overriding a policy removes the inherited policy, breaking the chain of inheritance from parent to child, and creates a replacement policy to add users as desired.  Inherited policies and their users can be restored by deleting the replacement policy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
“View the policies” and “modify the policies” component-level access policies are an exception to this inherited behavior. When a user is added to either policy, they are added to the current list of administrators. They do not override higher level administrators. For this reason, only component specific administrators are displayed for the “view the policies” and “modify the policies" access policies.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot modify the users/groups on an inherited policy.  Users and groups can only be added or removed from a parent policy or an override policy.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="viewing-policies-users"><a class="anchor" href="#viewing-policies-users"></a>Viewing Policies on Users</h4>
<div class="paragraph">
<p>From the UI, select “Users” from the Global Menu. This opens the NiFi Users dialog.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user-policies.png" alt="User Policies Window"></span></p>
</div>
<div class="paragraph">
<p>Select the View User Policies icon (<span class="image"><img src="./images/iconUserPolicies.png" alt="User Policies Icon"></span>).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user-policies-detail.png" alt="User Policies Detail"></span></p>
</div>
<div class="paragraph">
<p>The User Policies window displays the global and component level policies that have been set for the chosen user.  Select the Go To icon (<span class="image"><img src="./images/iconGoTo.png" alt="Go To Icon"></span>) to navigate to that component in the canvas.</p>
</div>
</div>
<div class="sect3">
<h4 id="access-policy-config-examples"><a class="anchor" href="#access-policy-config-examples"></a>Access Policy Configuration Examples</h4>
<div class="paragraph">
<p>The most effective way to understand how to create and apply access policies is to walk through some common examples.  The following scenarios assume User1 is an administrator and User2 is a newly added user that has only been given access to the UI.</p>
</div>
<div class="paragraph">
<p>Let’s begin with two processors on the canvas as our starting point: GenerateFlowFile and LogAttribute.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/access-policy-config-start.png" alt="Access Policy Config Start"></span></p>
</div>
<div class="paragraph">
<p>User1 can add components to the dataflow and is able to move, edit and connect all processors.  The details and properties of the root process group and processors are visible to User1.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user1-full-access.png" alt="User1 Full Access"></span></p>
</div>
<div class="paragraph">
<p>User1 wants to maintain their current privileges to the dataflow and its components.</p>
</div>
<div class="paragraph">
<p>User2 is unable to add components to the dataflow or move, edit, or connect components.  The details and properties of the root process group and processors are hidden from User2.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-restricted-access.png" alt="User2 Restricted Access"></span></p>
</div>
<div class="sect4">
<h5 id="moving-a-processor"><a class="anchor" href="#moving-a-processor"></a>Moving a Processor</h5>
<div class="paragraph">
<p>To allow User2 to move the GenerateFlowFile processor in the dataflow and only that processor, User1 performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the GenerateFlowFile processor so that it is highlighted.</p>
</li>
<li>
<p>Select the Access Policies icon (<span class="image"><img src="./images/iconAccessPolicies.png" alt="Access Policies Icon"></span>) from the Operate palette and the Access Policies dialog opens.</p>
</li>
<li>
<p>Select “modify the component” from the policy drop-down.
<span class="image"><img src="./images/processor-modify-policy.png" alt="Processor Modify Policy"></span>
The “modify the component” policy that currently exists on the processor (child) is the “modify the component” policy inherited from the root process group (parent) on which User1 has privileges.</p>
</li>
<li>
<p>Select the Override link in the policy inheritance message.  When creating the replacement policy, you are given a choice to override with a copy of the inherited policy or an empty policy.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/override_policy_copy_empty.png" alt="Create Override Policy"></span></p>
</div>
<div class="paragraph">
<p>Select the Override button to create a copy.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>On the replacement policy that is created, select the Add User icon (<span class="image"><img src="./images/iconAddUser.png" alt="Add User Icon"></span>). Find or enter User2 in the User Identity field and select OK.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/processor-replacement-modify-policy.png" alt="Processor Replacement Modify Policy"></span></p>
</div>
<div class="paragraph">
<p>With these changes, User1 maintains the ability to move both processors on the canvas.  User2 can now move the GenerateFlowFile processor but cannot move the LogAttribute processor.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-moved-processor.png" alt="User2 Moved Processor"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="editing-a-processor"><a class="anchor" href="#editing-a-processor"></a>Editing a Processor</h5>
<div class="paragraph">
<p>In the “Moving a Processor” example above, User2 was added to the “modify the component” policy for GenerateFlowFile.  Without the ability to view the processor properties, User2 is unable to modify the processor’s configuration.  In order to edit a component, a user must be on both the “view the component” and “modify the component” policies. To implement this, User1 performs the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the GenerateFlowFile processor.</p>
</li>
<li>
<p>Select the Access Policies icon (<span class="image"><img src="./images/iconAccessPolicies.png" alt="Access Policies Icon"></span>) from the Operate palette and the Access Policies dialog opens.</p>
</li>
<li>
<p>Select "view the component” from the policy drop-down.
<span class="image"><img src="./images/processor-view-policy.png" alt="Processor View Policy"></span>
The view the component” policy that currently exists on the processor (child) is the "view the component” policy inherited from the root process group (parent) on which User1 has privileges.</p>
</li>
<li>
<p>Select the Override link in the policy inheritance message, keep the default of Copy policy and select the Override button.</p>
</li>
<li>
<p>On the override policy that is created, select the Add User icon (<span class="image"><img src="./images/iconAddUser.png" alt="Add User Icon"></span>). Find or enter User2 in the User Identity field and select OK.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/processor-replacement-view-policy.png" alt="Processor Replacement View Policy"></span></p>
</div>
<div class="paragraph">
<p>With these changes, User1 maintains the ability to view and edit the processors on the canvas. User2 can now view and edit the GenerateFlowFile processor.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-edit-processor.png" alt="User2 Edit Processor"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="creating-a-connection"><a class="anchor" href="#creating-a-connection"></a>Creating a Connection</h5>
<div class="paragraph">
<p>With the access policies configured as discussed in the previous two examples, User1 is able to connect GenerateFlowFile to LogAttribute:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user1-create-connection.png" alt="User1 Create Connection"></span></p>
</div>
<div class="paragraph">
<p>User2 cannot make the connection:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-no-connection.png" alt="User2 No Connection"></span></p>
</div>
<div class="paragraph">
<p>This is because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User2 does not have modify access on the process group.</p>
</li>
<li>
<p>Even though User2 has view and modify access to the source component (GenerateFlowFile), User2 does not have an access policy on the destination component (LogAttribute).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To allow User2 to connect GenerateFlowFile to LogAttribute, as User1:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the root process group. The Operate palette is updated with details for the root process group.</p>
</li>
<li>
<p>Select the Access Policies icon (<span class="image"><img src="./images/iconAccessPolicies.png" alt="Access Policies Icon"></span>) from the Operate palette and the Access Policies dialog opens.</p>
</li>
<li>
<p>Select "modify the component” from the policy drop-down.
<span class="image"><img src="./images/process-group-modify-policy.png" alt="Process Group Modify Policy"></span></p>
</li>
<li>
<p>Select the Add User icon (<span class="image"><img src="./images/iconAddUser.png" alt="Add User Icon"></span>). Find or enter User2 and select OK.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/process-group-modify-policy-add-user2.png" alt="Process Group Modify Policy Add User2"></span></p>
</div>
<div class="paragraph">
<p>By adding User2 to the “modify the component” policy on the process group, User2 is added to the “modify the component” policy on the LogAttribute processor by policy inheritance.  To confirm this, highlight the LogAttribute processor and select the Access Policies icon (<span class="image"><img src="./images/iconAccessPolicies.png" alt="Access Policies Icon"></span>) from the Operate palette:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/processor-inherited-modify-policy.png" alt="User2 Inherited Edit Processor"></span></p>
</div>
<div class="paragraph">
<p>With these changes, User2 can now connect the GenerateFlowFile processor to the LogAttribute processor.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-can-connect.png" alt="User2 Can Connect"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-connected-processors.png" alt="User2 Connected Processors"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="editing-a-connection"><a class="anchor" href="#editing-a-connection"></a>Editing a Connection</h5>
<div class="paragraph">
<p>Assume User1 or User2 adds a ReplaceText processor to the root process group:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/replacetext-processor-added.png" alt="ReplaceText Processor Added"></span></p>
</div>
<div class="paragraph">
<p>User1 can select and change the existing connection (between GenerateFlowFile to LogAttribute) to now connect GenerateFlowFile to ReplaceText:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user1-edit-connection.png" alt="User1 Edit Connection"></span></p>
</div>
<div class="paragraph">
<p>User 2 is unable to perform this action.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-no-edit-connection.png" alt="User2 No Edit Connection"></span></p>
</div>
<div class="paragraph">
<p>To allow User2 to connect GenerateFlowFile to ReplaceText, as User1:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the root process group. The Operate palette is updated with details for the root process group.</p>
</li>
<li>
<p>Select the Access Policies icon (<span class="image"><img src="./images/iconAccessPolicies.png" alt="Access Policies Icon"></span>).</p>
</li>
<li>
<p>Select "view the component” from the policy drop-down.
<span class="image"><img src="./images/process-group-view-policy.png" alt="Process Group View Policy"></span></p>
</li>
<li>
<p>Select the Add User icon (<span class="image"><img src="./images/iconAddUser.png" alt="Add User Icon"></span>). Find or enter User2 and select OK.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/process-group-view-policy-add-user2.png" alt="Process Group View Policy Add User2"></span></p>
</div>
<div class="paragraph">
<p>Being added to both the view and modify policies for the process group, User2 can now connect the GenerateFlowFile processor to the ReplaceText processor.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/user2-edit-connection.png" alt="User2 Edit Connection"></span></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encryption"><a class="anchor" href="#encryption"></a>Encryption Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides an overview of the capabilities of NiFi to encrypt and decrypt data.</p>
</div>
<div class="paragraph">
<p>The <code>EncryptContent</code> processor allows for the encryption and decryption of data, both internal to NiFi and integrated with external systems, such as <code>openssl</code> and other data sources and consumers.</p>
</div>
<div class="sect2">
<h3 id="key-derivation-functions"><a class="anchor" href="#key-derivation-functions"></a>Key Derivation Functions</h3>
<div class="paragraph">
<p>Key Derivation Functions (KDF) are mechanisms by which human-readable information, usually a password or other secret information, is translated into a cryptographic key suitable for data protection. For further information, read <a href="https://en.wikipedia.org/wiki/Key_derivation_function">the Wikipedia entry on Key Derivation Functions</a>.
Currently, KDFs are ingested by <code>CipherProvider</code> implementations and return a fully-initialized <code>Cipher</code> object to be used for encryption or decryption. Due to the use of a <code>CipherProviderFactory</code>, the KDFs are not customizable at this time. Future enhancements will include the ability to provide custom cost parameters to the KDF at initialization time. As a work-around, <code>CipherProvider</code> instances can be initialized with custom cost parameters in the constructor but this is not currently supported by the <code>CipherProviderFactory</code>.
Here are the KDFs currently supported by NiFi (primarily in the <code>EncryptContent</code> processor for password-based encryption (PBE)) and relevant notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NiFi Legacy KDF</p>
<div class="ulist">
<ul>
<li>
<p>The original KDF used by NiFi for internal key derivation for PBE, this is 1000 iterations of the MD5 digest over the concatenation of the password and 8 or 16 bytes of random salt (the salt length depends on the selected cipher block size).</p>
</li>
<li>
<p>This KDF is <strong>deprecated as of NiFi 0.5.0</strong> and should only be used for backwards compatibility to decrypt data that was previously encrypted by a legacy version of NiFi.</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenSSL PKCS#5 v1.5 EVP_BytesToKey</p>
<div class="ulist">
<ul>
<li>
<p>This KDF was added in v0.4.0.</p>
</li>
<li>
<p>This KDF is provided for compatibility with data encrypted using OpenSSL&#8217;s default PBE, known as <code>EVP_BytesToKey</code>. This is a single iteration of MD5 over the concatenation of the password and 8 bytes of random ASCII salt. OpenSSL recommends using <code>PBKDF2</code> for key derivation but does not expose the library method necessary to the command-line tool, so this KDF is still the de facto default for command-line encryption.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Bcrypt</p>
<div class="ulist">
<ul>
<li>
<p>This KDF was added in v0.5.0.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Bcrypt">Bcrypt</a> is an adaptive function based on the <a href="https://en.wikipedia.org/wiki/Blowfish_(cipher)">Blowfish</a> cipher. This KDF is strongly recommended as it automatically incorporates a random 16 byte salt, configurable cost parameter (or "work factor"), and is hardened against brute-force attacks using <a href="https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units">GPGPU</a> (which share memory between cores) by requiring access to "large" blocks of memory during the key derivation. It is less resistant to <a href="https://en.wikipedia.org/wiki/Field-programmable_gate_array">FPGA</a> brute-force attacks where the gate arrays have access to individual embedded RAM blocks.</p>
</li>
<li>
<p>Because the length of a Bcrypt-derived key is always 184 bits, the complete output is then fed to a <code>SHA-512</code> digest and truncated to the desired key length. This provides the benefit of the avalanche effect on the formatted input.</p>
</li>
<li>
<p>The recommended minimum work factor is 12 (2<sup>12</sup> key derivation rounds) (as of 2/1/2016 on commodity hardware) and should be increased to the threshold at which legitimate systems will encounter detrimental delays (see schedule below or use <code>BcryptCipherProviderGroovyTest#testDefaultConstructorShouldProvideStrongWorkFactor()</code> to calculate safe minimums).</p>
</li>
<li>
<p>The salt format is <code>$2a$10$ABCDEFGHIJKLMNOPQRSTUV</code>. The salt is delimited by <code>$</code> and the three sections are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>2a</code> - the version of the format. An extensive explanation can be found <a href="http://blog.ircmaxell.com/2012/12/seven-ways-to-screw-up-bcrypt.html">here</a>. NiFi currently uses <code>2a</code> for all salts generated internally.</p>
</li>
<li>
<p><code>10</code> - the work factor. This is actually the log<sub>2</sub> value, so the total iteration count would be 2<sup>10</sup> in this case.</p>
</li>
<li>
<p><code>ABCDEFGHIJKLMNOPQRSTUV</code> - the 22 character, Base64-encoded, unpadded, raw salt value. This decodes to a 16 byte salt used in the key derivation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Scrypt</p>
<div class="ulist">
<ul>
<li>
<p>This KDF was added in v0.5.0.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Scrypt">Scrypt</a> is an adaptive function designed in response to <code>bcrypt</code>. This KDF is recommended as it requires relatively large amounts of memory for each derivation, making it resistant to hardware brute-force attacks.</p>
</li>
<li>
<p>The recommended minimum cost is <code>N</code>=2<sup>14</sup>, <code>r</code>=8, <code>p</code>=1 (as of 2/1/2016 on commodity hardware) and should be increased to the threshold at which legitimate systems will encounter detrimental delays (see schedule below or use <code>ScryptCipherProviderGroovyTest#testDefaultConstructorShouldProvideStrongParameters()</code> to calculate safe minimums).</p>
</li>
<li>
<p>The salt format is <code>$s0$e0101$ABCDEFGHIJKLMNOPQRSTUV</code>. The salt is delimited by <code>$</code> and the three sections are as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>s0</code> - the version of the format. NiFi currently uses <code>s0</code> for all salts generated internally.</p>
</li>
<li>
<p><code>e0101</code> - the cost parameters. This is actually a hexadecimal encoding of <code>N</code>, <code>r</code>, <code>p</code> using shifts. This can be formed/parsed using <code>Scrypt#encodeParams()</code> and <code>Scrypt#parseParameters()</code>.</p>
<div class="ulist">
<ul>
<li>
<p>Some external libraries encode <code>N</code>, <code>r</code>, and <code>p</code> separately in the form <code>$400$1$1$</code>. A utility method is available at <code>ScryptCipherProvider#translateSalt()</code> which will convert the external form to the internal form.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>ABCDEFGHIJKLMNOPQRSTUV</code> - the 12-44 character, Base64-encoded, unpadded, raw salt value. This decodes to a 8-32 byte salt used in the key derivation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>PBKDF2</p>
<div class="ulist">
<ul>
<li>
<p>This KDF was added in v0.5.0.</p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/PBKDF2">Password-Based Key Derivation Function 2</a> is an adaptive derivation function which uses an internal pseudorandom function (PRF) and iterates it many times over a password and salt (at least 16 bytes).</p>
</li>
<li>
<p>The PRF is recommended to be <code>HMAC/SHA-256</code> or <code>HMAC/SHA-512</code>. The use of an HMAC cryptographic hash function mitigates a length extension attack.</p>
</li>
<li>
<p>The recommended minimum number of iterations is 160,000 (as of 2/1/2016 on commodity hardware). This number should be doubled every two years (see schedule below or use <code>PBKDF2CipherProviderGroovyTest#testDefaultConstructorShouldProvideStrongIterationCount()</code> to calculate safe minimums).</p>
</li>
<li>
<p>This KDF is not memory-hard (can be parallelized massively with commodity hardware) but is still recommended as sufficient by <a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST SP 800-132 (PDF)</a> and many cryptographers (when used with a proper iteration count and HMAC cryptographic hash function).</p>
</li>
</ul>
</div>
</li>
<li>
<p>None</p>
<div class="ulist">
<ul>
<li>
<p>This KDF was added in v0.5.0.</p>
</li>
<li>
<p>This KDF performs no operation on the input and is a marker to indicate the raw key is provided to the cipher. The key must be provided in hexadecimal encoding and be of a valid length for the associated cipher/algorithm.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="additional-resources"><a class="anchor" href="#additional-resources"></a>Additional Resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://stackoverflow.com/a/30308723/70465">Explanation of optimal scrypt cost parameters and relationships</a></p>
</li>
<li>
<p><a href="http://csrc.nist.gov/publications/nistpubs/800-132/nist-sp800-132.pdf">NIST Special Publication 800-132</a></p>
</li>
<li>
<p><a href="https://www.owasp.org/index.php/Password_Storage_Cheat_Sheet#Work_Factor">OWASP Password Storage Work Factor Calculations</a></p>
</li>
<li>
<p><a href="http://security.stackexchange.com/a/3993/16485">PBKDF2 rounds calculations</a></p>
</li>
<li>
<p><a href="http://blog.ircmaxell.com/2014/03/why-i-dont-recommend-scrypt.html">Scrypt as KDF vs password storage vulnerabilities</a></p>
</li>
<li>
<p><a href="http://security.stackexchange.com/a/26253/16485">Scrypt vs. Bcrypt (as of 2010)</a></p>
</li>
<li>
<p><a href="http://security.stackexchange.com/a/6415/16485">Bcrypt vs PBKDF2</a></p>
</li>
<li>
<p><a href="http://wildlyinaccurate.com/bcrypt-choosing-a-work-factor/">Choosing a work factor for Bcrypt</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-security/site/docs/current/apidocs/org/springframework/security/crypto/bcrypt/BCrypt.html">Spring Security Bcrypt</a></p>
</li>
<li>
<p><a href="https://www.openssl.org/docs/man1.1.0/crypto/EVP_BytesToKey.html">OpenSSL EVP BytesToKey PKCS#1v1.5</a></p>
</li>
<li>
<p><a href="https://wiki.openssl.org/index.php/Manual:PKCS5_PBKDF2_HMAC(3)">OpenSSL PBKDF2 KDF</a></p>
</li>
<li>
<p><a href="http://security.stackexchange.com/a/29139/16485">OpenSSL KDF flaws description</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="salt-and-iv-encoding"><a class="anchor" href="#salt-and-iv-encoding"></a>Salt and IV Encoding</h3>
<div class="paragraph">
<p>Initially, the <code>EncryptContent</code> processor had a single method of deriving the encryption key from a user-provided password. This is now referred to as <code>NiFiLegacy</code> mode, effectively <code>MD5 digest, 1000 iterations</code>. In v0.4.0, another method of deriving the key, <code>OpenSSL PKCS#5 v1.5 EVP_BytesToKey</code> was added for compatibility with content encrypted outside of NiFi using the <code>openssl</code> command-line tool. Both of these <a href="#key-derivation-functions">Key Derivation Functions</a> (KDF) had hard-coded digest functions and iteration counts, and the salt format was also hard-coded. With v0.5.0, additional KDFs are introduced with variable iteration counts, work factors, and salt formats. In addition, <em>raw keyed encryption</em> was also introduced. This required the capacity to encode arbitrary salts and Initialization Vectors (IV) into the cipher stream in order to be recovered by NiFi or a follow-on system to decrypt these messages.</p>
</div>
<div class="paragraph">
<p>For the existing KDFs, the salt format has not changed.</p>
</div>
<div class="sect3">
<h4 id="nifi-legacy"><a class="anchor" href="#nifi-legacy"></a>NiFi Legacy</h4>
<div class="paragraph">
<p>The first 8 or 16 bytes of the input are the salt. The salt length is determined based on the selected algorithm&#8217;s cipher block length. If the cipher block size cannot be determined (such as with a stream cipher like <code>RC4</code>), the default value of 8 bytes is used. On decryption, the salt is read in and combined with the password to derive the encryption key and IV.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/nifi-legacy-salt.png" alt="NiFi Legacy Salt Encoding"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="openssl-pkcs-5-v1-5-evp_bytestokey"><a class="anchor" href="#openssl-pkcs-5-v1-5-evp_bytestokey"></a>OpenSSL PKCS#5 v1.5 EVP_BytesToKey</h4>
<div class="paragraph">
<p>OpenSSL allows for salted or unsalted key derivation. <em>*Unsalted key derivation is a security risk and is not recommended.*</em> If a salt is present, the first 8 bytes of the input are the ASCII string "<code>Salted__</code>" (<code>0x53 61 6C 74 65 64 5F 5F</code>) and the next 8 bytes are the ASCII-encoded salt. On decryption, the salt is read in and combined with the password to derive the encryption key and IV. If there is no salt header, the entire input is considered to be the cipher text.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/openssl-salt.png" alt="OpenSSL Salt Encoding"></span></p>
</div>
<div class="paragraph">
<p>For new KDFs, each of which allow for non-deterministic IVs, the IV must be stored alongside the cipher text. This is not a vulnerability, as the IV is not required to be secret, but simply to be unique for messages encrypted using the same key to reduce the success of cryptographic attacks. For these KDFs, the output consists of the salt, followed by the salt delimiter, UTF-8 string "<code>NiFiSALT</code>" (<code>0x4E 69 46 69 53 41 4C 54</code>) and then the IV, followed by the IV delimiter, UTF-8 string "<code>NiFiIV</code>" (<code>0x4E 69 46 69 49 56</code>), followed by the cipher text.</p>
</div>
</div>
<div class="sect3">
<h4 id="bcrypt-scrypt-pbkdf2"><a class="anchor" href="#bcrypt-scrypt-pbkdf2"></a>Bcrypt, Scrypt, PBKDF2</h4>
<div class="paragraph">
<p><span class="image"><img src="./images/bcrypt-salt.png" alt="Bcrypt Salt &amp; IV Encoding"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/scrypt-salt.png" alt="Scrypt Salt &amp; IV Encoding"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/pbkdf2-salt.png" alt="PBKDF2 Salt &amp; IV Encoding"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="java-cryptography-extension-jce-limited-strength-jurisdiction-policies"><a class="anchor" href="#java-cryptography-extension-jce-limited-strength-jurisdiction-policies"></a>Java Cryptography Extension (JCE) Limited Strength Jurisdiction Policies</h3>
<div class="paragraph">
<p>Because of US export regulations, default JVMs have <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html#importlimits">limits imposed on the strength of cryptographic operations</a> available to them. For example, AES operations are limited to <code>128 bit keys</code> by default. While <code>AES-128</code> is cryptographically safe, this can have unintended consequences, specifically on Password-based Encryption (PBE).</p>
</div>
<div class="paragraph">
<p>PBE is the process of deriving a cryptographic key for encryption or decryption from <em>user-provided secret material</em>, usually a password. Rather than a human remembering a (random-appearing) 32 or 64 character hexadecimal string, a password or passphrase is used.</p>
</div>
<div class="paragraph">
<p>A number of PBE algorithms provided by NiFi impose strict limits on the length of the password due to the underlying key length checks. Below is a table listing the maximum password length on a JVM with limited cryptographic strength.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Maximum Password Length on Limited Cryptographic Strength JVM</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Algorithm</th>
<th class="tableblock halign-left valign-top">Max Password Length</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHMD5AND128BITAES-CBC-OPENSSL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHMD5AND192BITAES-CBC-OPENSSL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHMD5AND256BITAES-CBC-OPENSSL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHMD5ANDDES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHMD5ANDRC2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHA1ANDRC2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHA1ANDDES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND128BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND192BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND256BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND40BITRC2-CBC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND128BITRC2-CBC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND40BITRC4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND128BITRC4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHA256AND128BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHA256AND192BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHA256AND256BITAES-CBC-BC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND2-KEYTRIPLEDES-CBC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAAND3-KEYTRIPLEDES-CBC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PBEWITHSHAANDTWOFISH-CBC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="allow-insecure-cryptographic-modes"><a class="anchor" href="#allow-insecure-cryptographic-modes"></a>Allow Insecure Cryptographic Modes</h3>
<div class="paragraph">
<p>By default, the <code>Allow Insecure Cryptographic Modes</code> property in <code>EncryptContent</code> processor settings is set to <code>not-allowed</code>. This means that if a password of fewer than <code>10</code> characters is provided, a validation error will occur. 10 characters is a conservative estimate and does not take into consideration full entropy calculations, patterns, etc.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/allow-weak-crypto.png" alt="Allow Insecure Cryptographic Modes" width="940"></span></p>
</div>
<div class="paragraph">
<p>On a JVM with limited strength cryptography, some PBE algorithms limit the maximum password length to 7, and in this case it will not be possible to provide a "safe" password. It is recommended to install the JCE Unlimited Strength Jurisdiction Policy files for the JVM to mitigate this issue.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">JCE Unlimited Strength Jurisdiction Policy files for Java 8</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If on a system where the unlimited strength policies cannot be installed, it is recommended to switch to an algorithm that supports longer passwords (see table above).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Allowing Weak Crypto</div>
<div class="paragraph">
<p>If it is not possible to install the unlimited strength jurisdiction policies, the <code>Allow Weak Crypto</code> setting can be changed to <code>allowed</code>, but <strong>this is <em>not</em> recommended</strong>. Changing this setting explicitly acknowledges the inherent risk in using weak cryptographic configurations.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is preferable to request upstream/downstream systems to switch to <a href="https://cwiki.apache.org/confluence/display/NIFI/Encryption+Information">keyed encryption</a> or use a "strong" <a href="https://cwiki.apache.org/confluence/display/NIFI/Key+Derivation+Function+Explanations">Key Derivation Function (KDF) supported by NiFi</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="encrypted-passwords-in-configuration-files"><a class="anchor" href="#encrypted-passwords-in-configuration-files"></a>Encrypted Passwords in Configuration Files</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to facilitate the secure setup of NiFi, you can use the <code>encrypt-config</code> command line utility to encrypt raw configuration values that NiFi decrypts in memory on startup. This extensible protection scheme transparently allows NiFi to use raw values in operation, while protecting them at rest.  In the future, hardware security modules (HSM) and external secure storage mechanisms will be integrated, but for now, an AES encryption provider is the default implementation.</p>
</div>
<div class="paragraph">
<p>This is a change in behavior; prior to 1.0, all configuration values were stored in plaintext on the file system. POSIX file permissions were recommended to limit unauthorized access to these files</p>
</div>
<div class="paragraph">
<p>If no administrator action is taken, the configuration values remain unencrypted.</p>
</div>
<div class="sect2">
<h3 id="encrypt-config_tool"><a class="anchor" href="#encrypt-config_tool"></a>Encrypt-Config Tool</h3>
<div class="paragraph">
<p>The <code>encrypt-config</code> command line tool (invoked as <code>./bin/encrypt-config.sh</code> or <code>bin\encrypt-config.bat</code>) reads from a <em>nifi.properties</em> file with plaintext sensitive configuration values, prompts for a master password or raw hexadecimal key, and encrypts each value. It replaces the plain values with the protected value in the same file, or writes to a new <em>nifi.properties</em> file if specified.</p>
</div>
<div class="paragraph">
<p>The default encryption algorithm utilized is AES/GCM 128/256-bit. 128-bit is used if the JCE Unlimited Strength Cryptographic Jurisdiction Policy files are not installed, and 256-bit is used if they are installed.</p>
</div>
<div class="paragraph">
<p>You can use the following command line options with the <code>encrypt-config</code> tool:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-A</code>,<code>--newFlowAlgorithm &lt;arg&gt;</code>               The algorithm to use to encrypt the sensitive processor properties in flow.xml.gz</p>
</li>
<li>
<p><code>-b</code>,<code>--bootstrapConf &lt;arg&gt;</code>                  The bootstrap.conf file to persist master key</p>
</li>
<li>
<p><code>-e</code>,<code>--oldKey &lt;arg&gt;</code>                         The old raw hexadecimal key to use during key migration</p>
</li>
<li>
<p><code>-f</code>,<code>--flowXml &lt;arg&gt;</code>                        The flow.xml.gz file currently protected with old password (will be overwritten)</p>
</li>
<li>
<p><code>-g</code>,<code>--outputFlowXml &lt;arg&gt;</code>                  The destination flow.xml.gz file containing protected config values (will not modify input flow.xml.gz)</p>
</li>
<li>
<p><code>-h</code>,<code>--help</code>                                 Prints this usage message</p>
</li>
<li>
<p><code>-i</code>,<code>--outputLoginIdentityProviders &lt;arg&gt;</code>   The destination login-identity-providers.xml file containing protected config values (will not modify input login-identity-providers.xml)</p>
</li>
<li>
<p><code>-k</code>,<code>--key &lt;arg&gt;</code>                            The raw hexadecimal key to use to encrypt the sensitive properties</p>
</li>
<li>
<p><code>-l</code>,<code>--loginIdentityProviders &lt;arg&gt;</code>         The login-identity-providers.xml file containing unprotected config values (will be overwritten)</p>
</li>
<li>
<p><code>-m</code>,<code>--migrate</code>                              If provided, the nifi.properties and/or login-identity-providers.xml sensitive properties will be re-encrypted with a new key</p>
</li>
<li>
<p><code>-n</code>,<code>--niFiProperties &lt;arg&gt;</code>                 The nifi.properties file containing unprotected config values (will be overwritten)</p>
</li>
<li>
<p><code>-o</code>,<code>--outputNiFiProperties &lt;arg&gt;</code>           The destination nifi.properties file containing protected config values (will not modify input nifi.properties)</p>
</li>
<li>
<p><code>-p</code>,<code>--password &lt;arg&gt;</code>                       The password from which to derive the key to use to encrypt the sensitive properties</p>
</li>
<li>
<p><code>-P</code>,<code>--newFlowProvider &lt;arg&gt;</code>                The security provider to use to encrypt the sensitive processor properties in flow.xml.gz</p>
</li>
<li>
<p><code>-r</code>,<code>--useRawKey</code>                            If provided, the secure console will prompt for the raw key value in hexadecimal form</p>
</li>
<li>
<p><code>-s</code>,<code>--propsKey &lt;arg&gt;</code>                       The password or key to use to encrypt the sensitive processor properties in flow.xml.gz</p>
</li>
<li>
<p><code>-v</code>,<code>--verbose</code>                              Sets verbose mode (default false)</p>
</li>
<li>
<p><code>-w</code>,<code>--oldPassword &lt;arg&gt;</code>                    The old password from which to derive the key during migration</p>
</li>
<li>
<p><code>-x</code>,<code>--encryptFlowXmlOnly</code>                   If provided, the properties in flow.xml.gz will be re-encrypted with a new key but the nifi.properties and/or login-identity-providers.xml files will not be modified</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example of how the tool works, assume that you have installed the tool on a machine supporting 256-bit encryption and with the following existing values in the <em>nifi.properties</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># security properties #
nifi.sensitive.props.key=thisIsABadSensitiveKeyPassword
nifi.sensitive.props.algorithm=PBEWITHMD5AND256BITAES-CBC-OPENSSL
nifi.sensitive.props.provider=BC
nifi.sensitive.props.additional.keys=

nifi.security.keystore=/path/to/keystore.jks
nifi.security.keystoreType=JKS
nifi.security.keystorePasswd=thisIsABadKeystorePassword
nifi.security.keyPasswd=thisIsABadKeyPassword
nifi.security.truststore=
nifi.security.truststoreType=
nifi.security.truststorePasswd=</pre>
</div>
</div>
<div class="paragraph">
<p>Enter the following arguments when using the tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>encrypt-config.sh
-b bootstrap.conf
-k 0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210
-n nifi.properties</pre>
</div>
</div>
<div class="paragraph">
<p>As a result, the <em>nifi.properties</em> file is overwritten with protected properties and sibling encryption identifiers (<code>aes/gcm/256</code>, the currently supported algorithm):</p>
</div>
<div class="listingblock">
<div class="content">
<pre># security properties #
nifi.sensitive.props.key=n2z+tTTbHuZ4V4V2||uWhdasyDXD4ZG2lMAes/vqh6u4vaz4xgL4aEbF4Y/dXevqk3ulRcOwf1vc4RDQ==
nifi.sensitive.props.key.protected=aes/gcm/256
nifi.sensitive.props.algorithm=PBEWITHMD5AND256BITAES-CBC-OPENSSL
nifi.sensitive.props.provider=BC
nifi.sensitive.props.additional.keys=

nifi.security.keystore=/path/to/keystore.jks
nifi.security.keystoreType=JKS
nifi.security.keystorePasswd=oBjT92hIGRElIGOh||MZ6uYuWNBrOA6usq/Jt3DaD2e4otNirZDytac/w/KFe0HOkrJR03vcbo
nifi.security.keystorePasswd.protected=aes/gcm/256
nifi.security.keyPasswd=ac/BaE35SL/esLiJ||+ULRvRLYdIDA2VqpE0eQXDEMjaLBMG2kbKOdOwBk/hGebDKlVg==
nifi.security.keyPasswd.protected=aes/gcm/256
nifi.security.truststore=
nifi.security.truststoreType=
nifi.security.truststorePasswd=</pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, the <em>bootstrap.conf</em> file is updated with the encryption key as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># Master key in hexadecimal format for encrypted sensitive configuration values
nifi.bootstrap.sensitive.key=0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210</pre>
</div>
</div>
<div class="paragraph">
<p>Sensitive configuration values are encrypted by the tool by default, however you can encrypt any additional properties, if desired.  To encrypt additional properties, specify them as comma-separated values in the <code>nifi.sensitive.props.additional.keys</code> property.</p>
</div>
<div class="paragraph">
<p>If the <em>nifi.properties</em> file already has valid protected values, those property values are not modified by the tool.</p>
</div>
<div class="paragraph">
<p>When applied to <em>login-identity-providers.xml</em>, the property elements are updated with an <code>encryption</code> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;!-- LDAP Provider --&gt;
&lt;provider&gt;
       &lt;identifier&gt;ldap-provider&lt;/identifier&gt;
       &lt;class&gt;org.apache.nifi.ldap.LdapProvider&lt;/class&gt;
       &lt;property name="Authentication Strategy"&gt;START_TLS&lt;/property&gt;
       &lt;property name="Manager DN"&gt;someuser&lt;/property&gt;
       &lt;property name="Manager Password" encryption="aes/gcm/128"&gt;q4r7WIgN0MaxdAKM||SGgdCTPGSFEcuH4RraMYEdeyVbOx93abdWTVSWvh1w+klA&lt;/property&gt;
       &lt;property name="TLS - Keystore"&gt;&lt;/property&gt;
       &lt;property name="TLS - Keystore Password" encryption="aes/gcm/128"&gt;Uah59TWX+Ru5GY5p||B44RT/LJtC08QWA5ehQf01JxIpf0qSJUzug25UwkF5a50g&lt;/property&gt;
       &lt;property name="TLS - Keystore Type"&gt;&lt;/property&gt;
      ...
   &lt;/provider&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sensitive-property-key-migration"><a class="anchor" href="#sensitive-property-key-migration"></a>Sensitive Property Key Migration</h3>
<div class="paragraph">
<p>In order to change the key used to encrypt the sensitive values, indicate <strong>migration mode</strong> using the <code>-m</code> or <code>--migrate</code> flag, provide the new key or password using the <code>-k</code> or <code>-p</code> flags as usual, and provide the existing key or password using <code>-e</code> or <code>-w</code> respectively. This will allow the toolkit to decrypt the existing values and re-encrypt them, and update <code>bootstrap.conf</code> with the new key. Only one of the key or password needs to be specified for each phase (old vs. new), and any combination is sufficient:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>old key &#8594; new key</p>
</li>
<li>
<p>old key &#8594; new password</p>
</li>
<li>
<p>old password &#8594; new key</p>
</li>
<li>
<p>old password &#8594; new password</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="existing-flow-migration"><a class="anchor" href="#existing-flow-migration"></a>Existing Flow Migration</h3>
<div class="paragraph">
<p>This tool can also be used to change the value of <code>nifi.sensitive.props.key</code> for an existing flow. The tool will read the existing <code>flow.xml.gz</code> and decrypt any sensitive component properties using the original key,
then re-encrypt the sensitive properties with the new key, and write out a new version of the <code>flow.xml.gz</code>, or overwrite the existing one.</p>
</div>
<div class="paragraph">
<p>The current sensitive properties key is not provided as a command-line argument, as it is read directly from <code>nifi.properties</code>. As this file is a required parameter, the <code>-x</code>/<code>--encryptFlowXmlOnly</code> flags tell the tool <strong>not</strong> to attempt to encrypt the properties in <code>nifi.properties</code>, but rather to <strong>only</strong> update the <code>nifi.sensitive.props.key</code> value with the new key. The exception to this is if the <code>nifi.properties</code> is <strong>already</strong> encrypted, the new sensitive property key will also be encrypted before being written to <code>nifi.properties</code>.</p>
</div>
<div class="paragraph">
<p>The following command would migrate the sensitive properties key in place, meaning it would overwrite the existing <code>flow.xml.gz</code> and <code>nifi.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./encrypt-config.sh -f /path/to/flow.xml.gz -n ./path/to/nifi.properties -s newpassword -x</pre>
</div>
</div>
<div class="paragraph">
<p>The following command would migrate the sensitive properties key and write out a separate <code>flow.xml.gz</code> and <code>nifi.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>./encrypt-config.sh -f ./path/to/src/flow.xml.gz -g /path/to/dest/flow.xml.gz -n /path/to/src/nifi.properties -o /path/to/dest/nifi.properties -s newpassword -x</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="encrypt-config_password"><a class="anchor" href="#encrypt-config_password"></a>Password Key Derivation</h3>
<div class="paragraph">
<p>Instead of providing a 32 or 64 character raw hexadecimal key, you can provide a password from which the key will be derived. As of 1.0.0, the password must be at least 12 characters, and the key will be derived using <code>SCrypt</code> with the parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>pw</code>&#8201;&#8212;&#8201;the password bytes in <code>UTF-8</code></p>
</li>
<li>
<p><code>salt</code>&#8201;&#8212;&#8201;the fixed salt value (<code>NIFI_SCRYPT_SALT</code>) bytes in <code>UTF-8</code></p>
</li>
<li>
<p><code>N</code>&#8201;&#8212;&#8201;2<sup>16</sup></p>
</li>
<li>
<p><code>r</code>&#8201;&#8212;&#8201;8</p>
</li>
<li>
<p><code>p</code>&#8201;&#8212;&#8201;1</p>
</li>
<li>
<p><code>dkLen</code>&#8201;&#8212;&#8201;determined by the JCE policies available</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As of August 2016, these values are determined to be strong for this threat model but may change in future versions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While fixed salts are counter to best practices, a static salt is necessary for deterministic key derivation without additional storage of the salt value.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="encrypt-config_secure_prompt"><a class="anchor" href="#encrypt-config_secure_prompt"></a>Secure Prompt</h3>
<div class="paragraph">
<p>If you prefer not to provide the password or raw key in the command-line invocation of the tool, leaving these arguments absent will prompt a secure console read of the password (by default) or raw key (if the <code>-r</code> flag is provided at invocation).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admin-toolkit"><a class="anchor" href="#admin-toolkit"></a>Administrative Tools</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The admin toolkit contains command line utilities for administrators to support NiFi maintenance in standalone
and clustered environments. These utilities include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Notify&#8201;&#8212;&#8201;The notification tool allows administrators to send bulletins to the NiFi UI using the command line.</p>
</li>
<li>
<p>Node Manager&#8201;&#8212;&#8201;The node manager tool allows administrators to perform a status check on a node as well as to connect, disconnect, or remove nodes that are part of a cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The admin toolkit is bundled with the nifi-toolkit and can be executed with scripts found in the <em>bin</em> folder.</p>
</div>
<div class="sect2">
<h3 id="prerequisites-for-running-admin-toolkit-in-a-secure-environment"><a class="anchor" href="#prerequisites-for-running-admin-toolkit-in-a-secure-environment"></a>Prerequisites for Running Admin Toolkit in a Secure Environment</h3>
<div class="paragraph">
<p>For secured nodes and clusters, two policies should be configured in advance:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the controller – A user that will have access to these utilities should be authorized in NiFi by creating an “access
the controller” policy (<code>/controller</code>) with both view and modify rights.</p>
</li>
<li>
<p>Proxy user request – If not previously set node’s identity (the DN value of the node’s certificate) should be authorized to proxy requests on behalf of a user</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When executing either the notify or node manager tools in a secured environment the <code>proxyDN</code> flag option should be used in
order to properly identify the user that was authorized to execute these commands. In non-secure environments, or if running
the status operation on the Node Manager tool, the flag is ignored.</p>
</div>
</div>
<div class="sect2">
<h3 id="notify"><a class="anchor" href="#notify"></a>Notify</h3>
<div class="paragraph">
<p>Notify allows administrators to send messages as bulletins to NiFi.  Notify is supported on NiFi version 1.2.0 and higher.
The notification tool is also available in a <em>notify.bat</em> file for use on Windows machines.</p>
</div>
<div class="paragraph">
<p>To send notifications:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>notify.sh -d {$NIFI_HOME} –b {nifi bootstrap file path} -m {message} [-l {level}] [-v]</pre>
</div>
</div>
<div class="paragraph">
<p>To show help:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>notify.sh -h</pre>
</div>
</div>
<div class="paragraph">
<p>The following are available options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-b,--bootstrapConf &lt;arg&gt;</code> Existing Bootstrap Configuration file (required)</p>
</li>
<li>
<p><code>-d,--nifiInstallDir &lt;arg&gt;</code> NiFi Root Folder (required)</p>
</li>
<li>
<p><code>-p,--proxyDN &lt;arg&gt;</code> Proxy or User DN (required for secured nodes)</p>
</li>
<li>
<p><code>-m,--message &lt;arg&gt;</code> Bulletin message (required)</p>
</li>
<li>
<p><code>-l,--level &lt;arg&gt;</code> Status level of bulletin – INFO, WARN, ERROR</p>
</li>
<li>
<p><code>-v,--verbose</code> Verbose messaging (optional)</p>
</li>
<li>
<p><code>-h,--help</code> Help Text (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example usage on Linux:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>./notify.sh -d /usr/nifi/nifi_current -b /usr/nifi/nifi_current/conf/bootstrap.conf -m "Test Message Server 1" -l "WARN" –p “ydavis@nifi” -v</pre>
</div>
</div>
<div class="paragraph">
<p>Example usage on Windows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>notify.bat -v -d "C:\\Program Files\\nifi\\nifi-1.2.0-SNAPSHOT" -b "C:\\Program Files\\nifi\\nifi-1.2.0-SNAPSHOT\\conf\\bootstrap.conf" -m "Test Message Server 1" -v</pre>
</div>
</div>
<div class="paragraph">
<p>Executing the above command line should result in a bulletin appearing in NiFi:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/nifi-notifications.png" alt="NiFi Notifications">
</div>
</div>
</div>
<div class="sect2">
<h3 id="node-manager"><a class="anchor" href="#node-manager"></a>Node Manager</h3>
<div class="paragraph">
<p>Node manager supports connecting, disconnecting and removing a node when in a cluster (an error message
displays if the node is not part of a cluster) as well as obtaining the status of a node.  When nodes are disconnected
from a cluster and need to be
connected or removed, a list of urls of connected nodes should be provided to send the required command to
the active cluster.  Node Manager supports NiFi version 1.0.0 and higher. Node Manager is also available in
<em>node-manager.bat</em> file for use on Windows machines.</p>
</div>
<div class="paragraph">
<p>To connect, disconnect, or remove a node from a cluster:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>node-manager.sh -d {$NIFI_HOME} –b { nifi bootstrap file path}
-o {remove|disconnect|connect|status} [-u {url list}] [-p {proxy name}] [-v]</pre>
</div>
</div>
<div class="paragraph">
<p>To show help:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>node-manager.sh -h</pre>
</div>
</div>
<div class="paragraph">
<p>The following are available options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-b,--bootstrapConf &lt;arg&gt;</code> Existing Bootstrap Configuration file (required)</p>
</li>
<li>
<p><code>-d,--nifiInstallDir &lt;arg&gt;</code> NiFi Root Folder (required)</p>
</li>
<li>
<p><code>-p,--proxyDN &lt;arg&gt;</code> Proxy or User DN (required for secured nodes doing connect, disconnect and remove operations)</p>
</li>
<li>
<p><code>-o, --operation &lt;arg&gt;</code> Operations supported: status, connect (cluster), disconnect (cluster), remove (cluster)</p>
</li>
<li>
<p><code>-u,--clusterUrls &lt;arg&gt;</code> Comma delimited list of active urls for cluster (optional). Not required for disconnecting a node yet will be needed when connecting or removing from a cluster</p>
</li>
<li>
<p><code>-v,--verbose</code> Verbose messaging (optional)</p>
</li>
<li>
<p><code>-h,--help</code> Help Text (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example usage on Linux:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># disconnect without cluster url list
./node-manager.sh
-d /usr/nifi/nifi_current
-b /usr/nifi/nifi_current/conf/bootstrap.conf
-o disconnect
–p ydavis@nifi
-v</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>#with url list
./node-manager.sh
-d /usr/nifi/nifi_current
-b /usr/nifi/nifi_current/conf/bootstrap.conf
-o connect
-u 'http://nifi-server-1:8080,http://nifi-server-2:8080'
-v</pre>
</div>
</div>
<div class="paragraph">
<p>Example usage on Windows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>node-manager.bat
-d "C:\\Program Files\\nifi\\nifi-1.2.0-SNAPSHOT"
-b "C:\\Program Files\\nifi\\nifi-1.2.0-SNAPSHOT\\conf\\bootstrap.conf"
-o disconnect
–v</pre>
</div>
</div>
<div class="sect3">
<h4 id="expected-behavior"><a class="anchor" href="#expected-behavior"></a>Expected behavior</h4>
<div class="paragraph">
<p>Status:</p>
</div>
<div class="paragraph">
<p>To obtain information on UI availability of a node, the status operation can be used to determine if the node is running.
If the <code>–u (clusterUrls)</code> option is not provided the current node url is checked otherwise the urls provided will be checked.</p>
</div>
<div class="paragraph">
<p>Disconnect:</p>
</div>
<div class="paragraph">
<p>When a node is disconnected from the cluster, the node itself should appear as disconnected and the cluster
should have a bulletin indicating the disconnect request was received. The cluster should also show <em>n-1/n</em>
nodes available in the cluster. For example, if 1 node is disconnected from a 3-node cluster, then 2 of 3 nodes
should show on the remaining nodes in the cluster.  Changes to the flow should not be allowed on the cluster
with a disconnected node.</p>
</div>
<div class="paragraph">
<p>Connect:</p>
</div>
<div class="paragraph">
<p>When the connect command is executed to reconnect a node to a cluster, upon completion the node itself
should show that it has rejoined the cluster by showing <em>n/n</em> nodes. Previously it would have shown Disconnected.
Other nodes in the cluster should receive a bulletin of the connect request and also show <em>n/n</em> nodes allowing
for changes to be allowed to the flow.</p>
</div>
<div class="paragraph">
<p>Remove:</p>
</div>
<div class="paragraph">
<p>When the remove command is executed the node should show as disconnected from a cluster.  The nodes remaining
in the cluster should show <em>n-1/n-1</em> nodes. For example, if 1 node is removed from a 3-node cluster, then the remaining 2 nodes
should show 2 of 2 nodes).  The cluster should allow a flow to be adjusted.  The removed node can rejoin the
cluster if restarted and the flow for the cluster has not changed. If the flow was changed, the flow template of
the removed node should be deleted before restarting the node to allow it to obtain the cluster flow (otherwise
an uninheritable flow file exception may occur).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="clustering"><a class="anchor" href="#clustering"></a>Clustering Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides a quick overview of NiFi Clustering and instructions on how to set up a basic cluster.
In the future, we hope to provide supplemental documentation that covers the NiFi Cluster Architecture in depth.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/zero-master-cluster-http-access.png" alt="NiFi Cluster HTTP Access">
</div>
</div>
<div class="paragraph">
<p>NiFi employs a Zero-Master Clustering paradigm. Each node in the cluster performs the same tasks on
the data, but each operates on a different set of data. One of the nodes is automatically elected (via Apache
ZooKeeper) as the Cluster Coordinator. All nodes in the cluster will then send heartbeat/status information
to this node, and this node is responsible for disconnecting nodes that do not report any heartbeat status
for some amount of time. Additionally, when a new node elects to join the cluster, the new node must first
connect to the currently-elected Cluster Coordinator in order to obtain the most up-to-date flow. If the Cluster
Coordinator determines that the node is allowed to join (based on its configured Firewall file), the current
flow is provided to that node, and that node is able to join the cluster, assuming that the node&#8217;s copy of the
flow matches the copy provided by the Cluster Coordinator. If the node&#8217;s version of the flow configuration differs
from that of the Cluster Coordinator&#8217;s, the node will not join the cluster.</p>
</div>
<div class="paragraph">
<p><strong>Why Cluster?</strong><br></p>
</div>
<div class="paragraph">
<p>NiFi Administrators or Dataflow Managers (DFMs) may find that using one instance of NiFi on a single server is not
enough to process the amount of data they have. So, one solution is to run the same dataflow on multiple NiFi servers.
However, this creates a management problem, because each time DFMs want to change or update the dataflow, they must make
those changes on each server and then monitor each server individually. By clustering the NiFi servers, it&#8217;s possible to
have that increased processing capability along with a single interface through which to make dataflow changes and monitor
the dataflow. Clustering allows the DFM to make each change only once, and that change is then replicated to all the nodes
of the cluster. Through the single interface, the DFM may also monitor the health and status of all the nodes.</p>
</div>
<div class="paragraph">
<p>NiFi Clustering is unique and has its own terminology. It&#8217;s important to understand the following terms before setting up a cluster.</p>
</div>
<div id="terminology" class="paragraph">
<p><strong>Terminology</strong><br></p>
</div>
<div class="paragraph">
<p><strong>NiFi Cluster Coordinator</strong>: A NiFi Cluster Cluster Coordinator is the node in a NiFi cluster that is responsible for carrying out
tasks to manage which nodes are allowed in the cluster and providing the most up-to-date flow to newly joining nodes. When a
DataFlow Manager manages a dataflow in a cluster, they are able to do so through the User Interface of any node in the cluster. Any
change made is then replicated to all nodes in the cluster.</p>
</div>
<div class="paragraph">
<p><strong>Nodes</strong>: Each cluster is made up of one or more nodes. The nodes do the actual data processing.</p>
</div>
<div class="paragraph">
<p><strong>Primary Node</strong>: Every cluster has one Primary Node. On this node, it is possible to run "Isolated Processors" (see below).
ZooKeeper is used to automatically elect a Primary Node. If that node disconnects from the cluster for any reason, a new
Primary Node will automatically be elected. Users can determine which node is currently elected as the Primary Node by
looking at the Cluster Management page of the User Interface.</p>
</div>
<div class="paragraph">
<p><strong>Isolated Processors</strong>: In a NiFi cluster, the same dataflow runs on all the nodes. As a result, every component in the flow
runs on every node. However, there may be cases when the DFM would not want every processor to run on every node. The most
common case is when using a processor that communicates with an external service using a protocol that does not scale well.
For example, the GetSFTP processor pulls from a remote directory, and if the GetSFTP Processor runs on every node in the
cluster tries simultaneously to pull from the same remote directory, there could be race conditions. Therefore, the DFM could
configure the GetSFTP on the Primary Node to run in isolation, meaning that it only runs on that node. It could pull in data and -
with the proper dataflow configuration - load-balance it across the rest of the nodes in the cluster. Note that while this
feature exists, it is also very common to simply use a standalone NiFi instance to pull data and feed it to the cluster.
It just depends on the resources available and how the Administrator decides to configure the cluster.</p>
</div>
<div class="paragraph">
<p><strong>Heartbeats</strong>: The nodes communicate their health and status to the currently elected Cluster Coordinator via "heartbeats",
which let the Coordinator know they are still connected to the cluster and working properly. By default, the nodes emit
heartbeats every 5 seconds, and if the Cluster Coordinator does not receive a heartbeat from a node within 40 seconds, it
disconnects the node due to "lack of heartbeat". (The 5-second setting is configurable in the <em>nifi.properties</em> file.
See the <a href="#system_properties">System Properties</a> section of this document for more information.) The reason that the Cluster Coordinator
disconnects the node is because the Coordinator needs to ensure that every node in the cluster is in sync, and if a node
is not heard from regularly, the Coordinator cannot be sure it is still in sync with the rest of the cluster. If, after
40 seconds, the node does send a new heartbeat, the Coordinator will automatically request that the node re-join the cluster,
to include the re-validation of the node&#8217;s flow.
Both the disconnection due to lack of heartbeat and the reconnection once a heartbeat is received are reported to the DFM
in the User Interface.</p>
</div>
<div class="paragraph">
<p><strong>Communication within the Cluster</strong><br></p>
</div>
<div class="paragraph">
<p>As noted, the nodes communicate with the Cluster Coordinator via heartbeats. When a Cluster Coordinator is elected, it updates
a well-known ZNode in Apache ZooKeeper with its connection information so that nodes understand where to send heartbeats. If one
of the nodes goes down, the other nodes in the cluster will not automatically pick up the load of the missing node. It is possible
for the DFM to configure the dataflow for failover contingencies; however, this is dependent on the dataflow design and does not
happen automatically.</p>
</div>
<div class="paragraph">
<p>When the DFM makes changes to the dataflow, the node that receives the request to change the flow communicates those changes to all
nodes and waits for each node to respond, indicating that it has made the change on its local flow.</p>
</div>
<div class="paragraph">
<p><strong>Dealing with Disconnected Nodes</strong><br></p>
</div>
<div class="paragraph">
<p>A DFM may manually disconnect a node from the cluster. But if a node becomes disconnected for any other reason (such as due to lack of heartbeat),
the Cluster Coordinator will show a bulletin on the User Interface. The DFM will not be able to make any changes to the dataflow until the issue
of the disconnected node is resolved. The DFM or the Administrator will need to troubleshoot the issue with the node and resolve it before any
new changes may be made to the dataflow. However, it is worth noting that just because a node is disconnected does not mean that it is not working;
this may happen for a few reasons, including that the node is unable to communicate with the Cluster Coordinator due to network problems.</p>
</div>
<div class="paragraph">
<p>There are cases where a DFM may wish to continue making changes to the flow, even though a node is not connected to the cluster.
In this case, they DFM may elect to remove the node from the cluster entirely through the Cluster Management dialog. Once removed,
the node cannot be rejoined to the cluster until it has been restarted.</p>
</div>
<div class="paragraph">
<p><strong>Flow Election</strong><br>
When a cluster first starts up, NiFi must determine which of the nodes have the
"correct" version of the flow. This is done by voting on the flows that each of the nodes has. When a node
attempts to connect to a cluster, it provides a copy of its local flow to the Cluster Coordinator. If no flow
has yet been elected the "correct" flow, the node&#8217;s flow is compared to each of the other Nodes' flows. If another
Node&#8217;s flow matches this one, a vote is cast for this flow. If no other Node has reported the same flow yet, this
flow will be added to the pool of possibly elected flows with one vote. After
some amount of time has elapsed (configured by setting the <code>nifi.cluster.flow.election.max.wait.time</code> property) or
some number of Nodes have cast votes (configured by setting the <code>nifi.cluster.flow.election.max.candidates</code> property),
a flow is elected to be the "correct" copy of the flow. All nodes that have incompatible flows are then disconnected
from the cluster while those with compatible flows inherit the cluster&#8217;s flow. Election is performed according to
the "popular vote" with the caveat that the winner will never be an "empty flow" unless all flows are empty. This
allows an administrator to remove a node&#8217;s <code>flow.xml.gz</code> file and restart the node, knowing that the node&#8217;s flow will
not be voted to be the "correct" flow unless no other flow is found.</p>
</div>
<div class="paragraph">
<p><strong>Basic Cluster Setup</strong><br></p>
</div>
<div class="paragraph">
<p>This section describes the setup for a simple three-node, non-secure cluster comprised of three instances of NiFi.</p>
</div>
<div class="paragraph">
<p>For each instance, certain properties in the <em>nifi.properties</em> file will need to be updated. In particular, the Web and Clustering properties
should be evaluated for your situation and adjusted accordingly. All the properties are described in the <a href="#system_properties">System Properties</a> section of this
guide; however, in this section, we will focus on the minimum properties that must be set for a simple cluster.</p>
</div>
<div class="paragraph">
<p>For all three instances, the Cluster Common Properties can be left with the default settings. Note, however, that if you change these settings,
they must be set the same on every instance in the cluster.</p>
</div>
<div class="paragraph">
<p>For each Node, the minimum properties to configure are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under the <em>Web Properties</em> section, set either the http or https port that you want the Node to run on.
Also, consider whether you need to set the http or https host property.</p>
</li>
<li>
<p>Under the <em>State Management section</em>, set the <code>nifi.state.management.provider.cluster</code> property
to the identifier of the Cluster State Provider. Ensure that the Cluster State Provider has been
configured in the <em>state-management.xml</em> file. See <a href="#state_providers">Configuring State Providers</a> for more information.</p>
</li>
<li>
<p>Under <em>Cluster Node</em> Properties, set the following:</p>
<div class="ulist">
<ul>
<li>
<p>nifi.cluster.is.node - Set this to <em>true</em>.</p>
</li>
<li>
<p>nifi.cluster.node.address - Set this to the fully qualified hostname of the node. If left blank, it defaults to "localhost".</p>
</li>
<li>
<p>nifi.cluster.node.protocol.port - Set this to an open port that is higher than 1024 (anything lower requires root).</p>
</li>
<li>
<p>nifi.cluster.node.protocol.threads - The number of threads that should be used to communicate with other nodes in the cluster. This property
defaults to 10. A thread pool is used for replicating requests to all nodes, and the
thread pool will never have fewer than this number of threads. It will grow as needed up to the maximum value set by the <code>nifi.cluster.node.protocol.max.threads</code>
property.</p>
</li>
<li>
<p>nifi.cluster.node.protocol.max.threads - The maximum number of threads that should be used to communicate with other nodes in the cluster. This property
defaults to 50. A thread pool is used for replication requests to all nodes, and the thread pool will have a "core" size that is configured by the
<code>nifi.cluster.node.protocol.threads</code> property. However, if necessary, the thread pool will increase the number of active threads to the limit
set by this property.</p>
</li>
<li>
<p>nifi.zookeeper.connect.string - The Connect String that is needed to connect to Apache ZooKeeper. This is a comma-separted list
of hostname:port pairs. For example, localhost:2181,localhost:2182,localhost:2183. This should contain a list of all ZooKeeper
instances in the ZooKeeper quorum.</p>
</li>
<li>
<p>nifi.zookeeper.root.node - The root ZNode that should be used in ZooKeeper. ZooKeeper provides a directory-like structure
for storing data. Each <em>directory</em> in this structure is referred to as a ZNode. This denotes the root ZNode, or <em>directory</em>,
that should be used for storing data. The default value is <em>/root</em>. This is important to set correctly, as which cluster
the NiFi instance attempts to join is determined by which ZooKeeper instance it connects to and the ZooKeeper Root Node
that is specified.</p>
</li>
<li>
<p>nifi.cluster.flow.election.max.wait.time - Specifies the amount of time to wait before electing a Flow as the "correct" Flow.
If the number of Nodes that have voted is equal to the number specified by the <code>nifi.cluster.flow.election.max.candidates</code>
property, the cluster will not wait this long. The default value is <em>5 mins</em>. Note that the time starts as soon as the first vote
is cast.</p>
</li>
<li>
<p>nifi.cluster.flow.election.max.candidates - Specifies the number of Nodes required in the cluster to cause early election
of Flows. This allows the Nodes in the cluster to avoid having to wait a long time before starting processing if we reach
at least this number of nodes in the cluster.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, it is possible to start up the cluster. It does not matter which order the instances start up. Navigate to the URL for
one of the nodes, and the User Interface should look similar to the following:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/ncm.png" alt="Clustered User Interface"></span></p>
</div>
<div class="paragraph">
<p><strong>Troubleshooting</strong></p>
</div>
<div class="paragraph">
<p>If you encounter issues and your cluster does not work as described, investigate the nifi-app.log and nifi-user.log
files on the nodes. If needed, you can change the logging level to DEBUG by editing the conf/logback.xml file. Specifically,
set the level="DEBUG" in the following line (instead of "INFO"):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    &lt;logger name="org.apache.nifi.web.api.config" level="INFO" additivity="false"&gt;
        &lt;appender-ref ref="USER_FILE"/&gt;
    &lt;/logger&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="state_management"><a class="anchor" href="#state_management"></a>State Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi provides a mechanism for Processors, Reporting Tasks, Controller Services, and the framework itself to persist state. This
allows a Processor, for example, to resume from the place where it left off after NiFi is restarted. Additionally, it allows for
a Processor to store some piece of information so that the Processor can access that information from all of the different nodes
in the cluster. This allows one node to pick up where another node left off, or to coordinate across all of the nodes in a cluster.</p>
</div>
<div class="sect2">
<h3 id="state_providers"><a class="anchor" href="#state_providers"></a>Configuring State Providers</h3>
<div class="paragraph">
<p>When a component decides to store or retrieve state, it does so by providing a "Scope" - either Node-local or Cluster-wide. The
mechanism that is used to store and retrieve this state is then determined based on this Scope, as well as the configured State
Providers. The <em>nifi.properties</em> file contains three different properties that are relevant to configuring these State Providers.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.configuration.file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first is the property that specifies an external XML file that is used for configuring the local and/or cluster-wide State Providers. This XML file may contain configurations for multiple providers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.provider.local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property that provides the identifier of the local State Provider configured in this XML file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.provider.cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Similarly, the property provides the identifier of the cluster-wide State Provider configured in this XML file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This XML file consists of a top-level <code>state-management</code> element, which has one or more <code>local-provider</code> and zero or more <code>cluster-provider</code>
elements. Each of these elements then contains an <code>id</code> element that is used to specify the identifier that can be referenced in the
<em>nifi.properties</em> file, as well as a <code>class</code> element that specifies the fully-qualified class name to use in order to instantiate the State
Provider. Finally, each of these elements may have zero or more <code>property</code> elements. Each <code>property</code> element has an attribute, <code>name</code> that is the name
of the <code>property</code> that the State Provider supports. The textual content of the property element is the value of the property.</p>
</div>
<div class="paragraph">
<p>Once these State Providers have been configured in the <em>state-management.xml</em> file (or whatever file is configured), those Providers may be
referenced by their identifiers.</p>
</div>
<div class="paragraph">
<p>By default, the Local State Provider is configured to be a <code>WriteAheadLocalStateProvider</code> that persists the data to the
<em>$NIFI_HOME/state/local</em> directory. The default Cluster State Provider is configured to be a <code>ZooKeeperStateProvider</code>. The default
ZooKeeper-based provider must have its <code>Connect String</code> property populated before it can be used. It is also advisable, if multiple NiFi instances
will use the same ZooKeeper instance, that the value of the <code>Root Node</code> property be changed. For instance, one might set the value to
<code>/nifi/&lt;team name&gt;/production</code>. A <code>Connect String</code> takes the form of comma separated &lt;host&gt;:&lt;port&gt; tuples, such as
my-zk-server1:2181,my-zk-server2:2181,my-zk-server3:2181. In the event a port is not specified for any of the hosts, the ZooKeeper default of
2181 is assumed.</p>
</div>
<div class="paragraph">
<p>When adding data to ZooKeeper, there are two options for Access Control: <code>Open</code> and <code>CreatorOnly</code>. If the <code>Access Control</code> property is
set to <code>Open</code>, then anyone is allowed to log into ZooKeeper and have full permissions to see, change, delete, or administer the data.
If <code>CreatorOnly</code> is specified, then only the user that created the data is allowed to read, change, delete, or administer the data.
In order to use the <code>CreatorOnly</code> option, NiFi must provide some form of authentication. See the <a href="#zk_access_control">ZooKeeper Access Control</a>
section below for more information on how to configure authentication.</p>
</div>
<div class="paragraph">
<p>If NiFi is configured to run in a standalone mode, the <code>cluster-provider</code> element need not be populated in the <em>state-management.xml</em>
file and will actually be ignored if they are populated. However, the <code>local-provider</code> element must always be present and populated.
Additionally, if NiFi is run in a cluster, each node must also have the <code>cluster-provider</code> element present and properly configured.
Otherwise, NiFi will fail to startup.</p>
</div>
<div class="paragraph">
<p>While there are not many properties that need to be configured for these providers, they were externalized into a separate <em>state-management.xml</em>
file, rather than being configured via the <em>nifi.properties</em> file, simply because different implementations may require different properties,
and it is easier to maintain and understand the configuration in an XML-based file such as this, than to mix the properties of the Provider
in with all of the other NiFi framework-specific properties.</p>
</div>
<div class="paragraph">
<p>It should be noted that if Processors and other components save state using the Clustered scope, the Local State Provider will be used
if the instance is a standalone instance (not in a cluster) or is disconnected from the cluster. This also means that if a standalone instance
is migrated to become a cluster, then that state will no longer be available, as the component will begin using the Clustered State Provider
instead of the Local State Provider.</p>
</div>
</div>
<div class="sect2">
<h3 id="embedded_zookeeper"><a class="anchor" href="#embedded_zookeeper"></a>Embedded ZooKeeper Server</h3>
<div class="paragraph">
<p>As mentioned above, the default State Provider for cluster-wide state is the <code>ZooKeeperStateProvider</code>. At the time of this writing, this is the
only State Provider that exists for handling cluster-wide state. What this means is that NiFi has dependencies on ZooKeeper in order to
behave as a cluster. However, there are many environments in which NiFi is deployed where there is no existing ZooKeeper ensemble being maintained.
In order to avoid the burden of forcing administrators to also maintain a separate ZooKeeper instance, NiFi provides the option of starting an
embedded ZooKeeper server.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.embedded.zookeeper.start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether or not this instance of NiFi should run an embedded ZooKeeper server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.embedded.zookeeper.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Properties file that provides the ZooKeeper properties to use if <code>nifi.state.management.embedded.zookeeper.start</code> is set to true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This can be accomplished by setting the <code>nifi.state.management.embedded.zookeeper.start</code> property in <em>nifi.properties</em> to <code>true</code> on those nodes
that should run the embedded ZooKeeper server. Generally, it is advisable to run ZooKeeper on either 3 or 5 nodes. Running on fewer than 3 nodes
provides less durability in the face of failure. Running on more than 5 nodes generally produces more network traffic than is necessary. Additionally,
running ZooKeeper on 4 nodes provides no more benefit than running on 3 nodes, ZooKeeper requires a majority of nodes be active in order to function.
However, it is up to the administrator to determine the number of nodes most appropriate to the particular deployment of NiFi.</p>
</div>
<div class="paragraph">
<p>If the <code>nifi.state.management.embedded.zookeeper.start</code> property is set to <code>true</code>, the <code>nifi.state.management.embedded.zookeeper.properties</code> property
in <em>nifi.properties</em> also becomes relevant. This specifies the ZooKeeper properties file to use. At a minimum, this properties file needs to be populated
with the list of ZooKeeper servers. The servers are specified as properties in the form of <code>server.1</code>, <code>server.2</code>, to <code>server.n</code>. Each of these servers is
configured as &lt;hostname&gt;:&lt;quorum port&gt;[:&lt;leader election port&gt;]. For example, <code>myhost:2888:3888</code>. This list of nodes should be the same nodes in the NiFi
cluster that have the <code>nifi.state.management.embedded.zookeeper.start</code> property set to <code>true</code>. Also note that because ZooKeeper will be listening on these
ports, the firewall may need to be configured to open these ports for incoming traffic, at least between nodes in the cluster. Additionally, the port to
listen on for client connections must be opened in the firewall. The default value for this is <em>2181</em> but can be configured via the <em>clientPort</em> property
in the <em>zookeeper.properties</em> file.</p>
</div>
<div class="paragraph">
<p>When using an embedded ZooKeeper, the ./<em>conf/zookeeper.properties</em> file has a property named <code>dataDir</code>. By default, this value is set to <code>./state/zookeeper</code>.
If more than one NiFi node is running an embedded ZooKeeper, it is important to tell the server which one it is. This is accomplished by creating a file named
<em>myid</em> and placing it in ZooKeeper’s data directory. The contents of this file should be the index of the server as specific by the <code>server.&lt;number&gt;</code>. So for
one of the ZooKeeper servers, we will accomplish this by performing the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cd $NIFI_HOME
mkdir state
mkdir state/zookeeper
echo 1 &gt; state/zookeeper/myid</code></pre>
</div>
</div>
<div class="paragraph">
<p>For the next NiFi Node that will run ZooKeeper, we can accomplish this by performing the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cd $NIFI_HOME
mkdir state
mkdir state/zookeeper
echo 2 &gt; state/zookeeper/myid</code></pre>
</div>
</div>
<div class="paragraph">
<p>And so on.</p>
</div>
<div class="paragraph">
<p>For more information on the properties used to administer ZooKeeper, see the
<a href="https://zookeeper.apache.org/doc/current/zookeeperAdmin.html">ZooKeeper Admin Guide</a>.</p>
</div>
<div class="paragraph">
<p>For information on securing the embedded ZooKeeper Server, see the <a href="#securing_zookeeper">Securing ZooKeeper</a> section below.</p>
</div>
</div>
<div class="sect2">
<h3 id="zk_access_control"><a class="anchor" href="#zk_access_control"></a>ZooKeeper Access Control</h3>
<div class="paragraph">
<p>ZooKeeper provides Access Control to its data via an Access Control List (ACL) mechanism. When data is written to ZooKeeper, NiFi will provide an ACL
that indicates that any user is allowed to have full permissions to the data, or an ACL that indicates that only the user that created the data is
allowed to access the data. Which ACL is used depends on the value of the <code>Access Control</code> property for the <code>ZooKeeperStateProvider</code> (see the
<a href="#state_providers">Configuring State Providers</a> section for more information).</p>
</div>
<div class="paragraph">
<p>In order to use an ACL that indicates that only the Creator is allowed to access the data, we need to tell ZooKeeper who the Creator is. There are two
mechanisms for accomplishing this. The first mechanism is to provide authentication using Kerberos. See <a href="#zk_kerberos_client">Kerberizing NiFi&#8217;s ZooKeeper Client</a> for more information.</p>
</div>
<div class="paragraph">
<p>The second option is to use a user name and password. This is configured by specifying a value for the <code>Username</code> and a value for the <code>Password</code> properties
for the <code>ZooKeeperStateProvider</code> (see the <a href="#state_providers">Configuring State Providers</a> section for more information). The important thing to keep in mind here, though, is that ZooKeeper
will pass around the password in plain text. This means that using a user name and password should not be used unless ZooKeeper is running on localhost as a
one-instance cluster, or if communications with ZooKeeper occur only over encrypted communications, such as a VPN or an SSL connection. ZooKeeper will be
providing support for SSL connections in version 3.5.0.</p>
</div>
</div>
<div class="sect2">
<h3 id="securing_zookeeper"><a class="anchor" href="#securing_zookeeper"></a>Securing ZooKeeper</h3>
<div class="paragraph">
<p>When NiFi communicates with ZooKeeper, all communications, by default, are non-secure, and anyone who logs into ZooKeeper is able to view and manipulate all
of the NiFi state that is stored in ZooKeeper. To prevent this, we can use Kerberos to manage the authentication. At this time, ZooKeeper does not provide
support for encryption via SSL. Support for SSL in ZooKeeper is being actively developed and is expected to be available in the 3.5.x release version.</p>
</div>
<div class="paragraph">
<p>In order to secure the communications, we need to ensure that both the client and the server support the same configuration. Instructions for configuring the
NiFi ZooKeeper client and embedded ZooKeeper server to use Kerberos are provided below.</p>
</div>
<div class="paragraph">
<p>If Kerberos is not already setup in your environment, you can find information on installing and setting up a Kerberos Server at
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Smart_Cards/Configuring_a_Kerberos_5_Server.html"><em>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Smart_Cards/Configuring_a_Kerberos_5_Server.html</em></a>
. This guide assumes that Kerberos already has been installed in the environment in which NiFi is running.</p>
</div>
<div class="paragraph">
<p>Note, the following procedures for kerberizing an Embedded ZooKeeper server in your NiFi Node and kerberizing a ZooKeeper NiFi client will require that
Kerberos client libraries be installed. This is accomplished in Fedora-based Linux distributions via:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>yum install krb5-workstation</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is complete, the /etc/krb5.conf will need to be configured appropriately for your organization’s Kerberos environment.</p>
</div>
<div class="sect3">
<h4 id="zk_kerberos_server"><a class="anchor" href="#zk_kerberos_server"></a>Kerberizing Embedded ZooKeeper Server</h4>
<div class="paragraph">
<p>The krb5.conf file on the systems with the embedded zookeeper servers should be identical to the one on the system where the krb5kdc service is running.
When using the embedded ZooKeeper server, we may choose to secure the server by using Kerberos. All nodes configured to launch an embedded ZooKeeper and
using Kerberos should follow these steps. When using the embedded ZooKeeper server, we may choose to secure the server by using Kerberos. All nodes
configured to launch an embedded ZooKeeper and using Kerberos should follow these steps.</p>
</div>
<div class="paragraph">
<p>In order to use Kerberos, we first need to generate a Kerberos Principal for our ZooKeeper servers. The following command is run on the server where the
krb5kdc service is running. This is accomplished via the kadmin tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kadmin: addprinc "zookeeper/myHost.example.com@EXAMPLE.COM"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we are creating a Principal with the primary <code>zookeeper/myHost.example.com</code>, using the realm <code>EXAMPLE.COM</code>. We need to use a Principal whose
name is <code>&lt;service name&gt;/&lt;instance name&gt;</code>. In this case, the service is <code>zookeeper</code> and the instance name is <code>myHost.example.com</code> (the fully qualified name of our host).</p>
</div>
<div class="paragraph">
<p>Next, we will need to create a KeyTab for this Principal, this command is run on the server with the NiFi instance with an embedded zookeeper server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kadmin: xst -k zookeeper-server.keytab zookeeper/myHost.example.com@EXAMPLE.COM</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a file in the current directory named <code>zookeeper-server.keytab</code>. We can now copy that file into the <code>$NIFI_HOME/conf/</code> directory. We should ensure
that only the user that will be running NiFi is allowed to read this file.</p>
</div>
<div class="paragraph">
<p>We will need to repeat the above steps for each of the instances of NiFi that will be running the embedded ZooKeeper server, being sure to replace <em>myHost.example.com</em> with
<em>myHost2.example.com</em>, or whatever fully qualified hostname the ZooKeeper server will be run on.</p>
</div>
<div class="paragraph">
<p>Now that we have our KeyTab for each of the servers that will be running NiFi, we will need to configure NiFi’s embedded ZooKeeper server to use this configuration.
ZooKeeper uses the Java Authentication and Authorization Service (JAAS), so we need to create a JAAS-compatible file In the <code>$NIFI_HOME/conf/</code> directory, create a file
named <code>zookeeper-jaas.conf</code> (this file will already exist if the Client has already been configured to authenticate via Kerberos. That’s okay, just add to the file).
We will add to this file, the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Server {
  com.sun.security.auth.module.Krb5LoginModule required
  useKeyTab=true
  keyTab="./conf/zookeeper-server.keytab"
  storeKey=true
  useTicketCache=false
  principal="zookeeper/myHost.example.com@EXAMPLE.COM";
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure to replace the value of <em>principal</em> above with the appropriate Principal, including the fully qualified domain name of the server.</p>
</div>
<div class="paragraph">
<p>Next, we need to tell NiFi to use this as our JAAS configuration. This is done by setting a JVM System Property, so we will edit the <code>conf/bootstrap.conf</code> file.
If the Client has already been configured to use Kerberos, this is not necessary, as it was done above. Otherwise, we will add the following line to our <em>bootstrap.conf</em> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.arg.15=-Djava.security.auth.login.config=./conf/zookeeper-jaas.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: this additional line in the file doesn’t have to be number 15, it just has to be added to the bootstrap.conf file, use whatever number is appropriate for your configuration.</p>
</div>
<div class="paragraph">
<p>We will want to initialize our Kerberos ticket by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kinit –kt zookeeper-server.keytab "zookeeper/myHost.example.com@EXAMPLE.COM"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, be sure to replace the Principal with the appropriate value, including your realm and your fully qualified hostname.</p>
</div>
<div class="paragraph">
<p>Finally, we need to tell the Kerberos server to use the SASL Authentication Provider. To do this, we edit the <code>$NIFI_HOME/conf/zookeeper.properties</code> file and add the following
lines:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider
jaasLoginRenew=3600000
requireClientAuthScheme=sasl</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last line is optional but specifies that clients MUST use Kerberos to communicate with our ZooKeeper instance.</p>
</div>
<div class="paragraph">
<p>Now, we can start NiFi, and the embedded ZooKeeper server will use Kerberos as the authentication mechanism.</p>
</div>
</div>
<div class="sect3">
<h4 id="zk_kerberos_client"><a class="anchor" href="#zk_kerberos_client"></a>Kerberizing NiFi&#8217;s ZooKeeper Client</h4>
<div class="paragraph">
<p>Note: The NiFi nodes running the embedded zookeeper server will also need to follow the below procedure since they will also be acting as a client at
the same time.</p>
</div>
<div class="paragraph">
<p>The preferred mechanism for authenticating users with ZooKeeper is to use Kerberos. In order to use Kerberos to authenticate, we must configure a few
system properties, so that the ZooKeeper client knows who the user is and where the KeyTab file is. All nodes configured to store cluster-wide state
using <code>ZooKeeperStateProvider</code> and using Kerberos should follow these steps.</p>
</div>
<div class="paragraph">
<p>First, we must create the Principal that we will use when communicating with ZooKeeper. This is generally done via the <code>kadmin</code> tool:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kadmin: addprinc "nifi@EXAMPLE.COM"</code></pre>
</div>
</div>
<div class="paragraph">
<p>A Kerberos Principal is made up of three parts: the primary, the instance, and the realm. Here, we are creating a Principal with the primary <code>nifi</code>,
no instance, and the realm <code>EXAMPLE.COM</code>. The primary (<code>nifi</code>, in this case) is the identifier that will be used to identify the user when authenticating
via Kerberos.</p>
</div>
<div class="paragraph">
<p>After we have created our Principal, we will need to create a KeyTab for the Principal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kadmin: xst -k nifi.keytab nifi@EXAMPLE.COM</code></pre>
</div>
</div>
<div class="paragraph">
<p>This keytab file can be copied to the other NiFi nodes with embedded zookeeper servers.</p>
</div>
<div class="paragraph">
<p>This will create a file in the current directory named <code>nifi.keytab</code>. We can now copy that file into the <em>$NIFI_HOME/conf/</em> directory. We should ensure
that only the user that will be running NiFi is allowed to read this file.</p>
</div>
<div class="paragraph">
<p>Next, we need to configure NiFi to use this KeyTab for authentication. Since ZooKeeper uses the Java Authentication and Authorization Service (JAAS), we need to
create a JAAS-compatible file. In the <code>$NIFI_HOME/conf/</code> directory, create a file named <code>zookeeper-jaas.conf</code> and add to it the following snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>Client {
  com.sun.security.auth.module.Krb5LoginModule required
  useKeyTab=true
  keyTab="./conf/nifi.keytab"
  storeKey=true
  useTicketCache=false
  principal="nifi@EXAMPLE.COM";
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we need to tell NiFi to use this as our JAAS configuration. This is done by setting a JVM System Property, so we will edit the <em>conf/bootstrap.conf</em> file.
We add the following line anywhere in this file in order to tell the NiFi JVM to use this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.arg.15=-Djava.security.auth.login.config=./conf/zookeeper-jaas.conf</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can initialize our Kerberos ticket by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kinit -kt nifi.keytab nifi@EXAMPLE.COM</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, when we start NiFi, it will use Kerberos to authentication as the <code>nifi</code> user when communicating with ZooKeeper.</p>
</div>
</div>
<div class="sect3">
<h4 id="troubleshooting_kerberos"><a class="anchor" href="#troubleshooting_kerberos"></a>Troubleshooting Kerberos Configuration</h4>
<div class="paragraph">
<p>When using Kerberos, it is import to use fully-qualified domain names and not use <em>localhost</em>. Please ensure that the fully qualified hostname of each server is used
in the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>conf/zookeeper.properties</em> file should use FQDN for <code>server.1</code>, <code>server.2</code>, &#8230;&#8203;, <code>server.N</code> values.</p>
</li>
<li>
<p>The <code>Connect String</code> property of the ZooKeeperStateProvider</p>
</li>
<li>
<p>The /etc/hosts file should also resolve the FQDN to an IP address that is <strong>not</strong> <em>127.0.0.1</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Failure to do so, may result in errors similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>2016-01-08 16:08:57,888 ERROR [pool-26-thread-1-SendThread(localhost:2181)] o.a.zookeeper.client.ZooKeeperSaslClient An error: (java.security.PrivilegedActionException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7) - LOOKING_UP_SERVER)]) occurred when evaluating Zookeeper Quorum Member's  received SASL token. Zookeeper Client will go to AUTH_FAILED state.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are problems communicating or authenticating with Kerberos,
<a href="http://docs.oracle.com/javase/7/docs/technotes/guides/security/jgss/tutorials/Troubleshooting.html">this Troubleshooting Guide</a> may be of value.</p>
</div>
<div class="paragraph">
<p>One of the most important notes in the above Troubleshooting guide is the mechanism for turning on Debug output for Kerberos.
This is done by setting the <code>sun.security.krb5.debug</code> environment variable.
In NiFi, this is accomplished by adding the following line to the _$NIFI_HOME/conf/bootstrap.conf` file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>java.arg.16=-Dsun.security.krb5.debug=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will cause the debug output to be written to the NiFi Bootstrap log file. By default, this is located at <em>$NIFI_HOME/logs/nifi-bootstrap.log</em>.
This output can be rather verbose but provides extremely valuable information for troubleshooting Kerberos failures.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zookeeper_migrator"><a class="anchor" href="#zookeeper_migrator"></a>ZooKeeper Migrator</h3>
<div class="paragraph">
<p>You can use the NiFi ZooKeeper Migrator to perform the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moving ZooKeeper information from one ZooKeeper cluster to another</p>
</li>
<li>
<p>Migrating ZooKeeper node ownership</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, you may want to use the ZooKeeper Migrator when you are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Upgrading from NiFi 0.x to NiFi 1.x in which embedded ZooKeepers are used</p>
</li>
<li>
<p>Migrating from an embedded ZooKeeper in NiFi 0.x or 1.x to an external ZooKeeper</p>
</li>
<li>
<p>Upgrading from NiFi 0.x with an external ZooKeeper to NiFi 1.x with the same external ZooKeeper</p>
</li>
<li>
<p>Migrating from an external ZooKeeper to an embedded ZooKeeper in NiFi 1.x</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NiFi ZooKeeper Migrator is part of the NiFi Toolkit and is downloaded separately from the
<a href="https://nifi.apache.org/download.html">Apache NiFi download page</a>.</p>
</div>
<div class="sect3">
<h4 id="zk_migrator_command_line_parameters"><a class="anchor" href="#zk_migrator_command_line_parameters"></a>zk-migrator.sh Command Line Parameters</h4>
<div class="paragraph">
<p>You can use the following command line options with the ZooKeeper Migrator:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-a,--auth &lt;username:password&gt;</code>               Allows the specification of a username and password for authentication with ZooKeeper.  This option is mutually exclusive with the <code>-k,--krb-conf</code> option.</p>
</li>
<li>
<p><code>-f,--file &lt;filename&gt;</code>                        The file used for ZooKeeper data serialized as JSON.  When used with the <code>-r,--receive</code> option, data read from ZooKeeper will be stored in the given filename.  When used with the <code>-s,--send</code> option, the data in the file will be sent to ZooKeeper.</p>
</li>
<li>
<p><code>-h,--help</code>                                   Prints help, displays available parameters with descriptions</p>
</li>
<li>
<p><code>--ignore-source</code>                             Allows the ZooKeeper Migrator to write to the ZooKeeper and path from which the data was obtained.</p>
</li>
<li>
<p><code>-k,--krb-conf &lt;jaas-filename&gt;</code>               Allows the specification of a JAAS configuration file to allow authentication with a ZooKeeper configured to use Kerberos.  This option is mutually exclusive with the <code>-a,--auth</code> option.</p>
</li>
<li>
<p><code>-r,--receive</code>                                Receives data from ZooKeeper and writes to the given filename (if the <code>-f,--file</code> option is provided) or standard output. The data received will contain the full path to each node read from ZooKeeper. This option is mutually exclusive with the <code>-s,--send</code> option.</p>
</li>
<li>
<p><code>-s,--send</code>                                   Sends data to ZooKeeper that is read from the given filename (if the <code>-f,--file</code> option is provided) or standard input. The paths for each node in the data being sent to ZooKeeper are absolute paths, and will be stored in ZooKeeper under the <strong>path</strong> portion of the <code>-z,--zookeeper</code> argument.  Typically, the <strong>path</strong> portion of the argument can be omitted, which will store the nodes at their absolute paths. This option is mutually exclusive with the <code>-r,--receive</code> option.</p>
</li>
<li>
<p><code>-z,--zookeeper &lt;zookeeper-endpoint&gt;</code>         The ZooKeeper server(s) to use, specified by a connect string, comprised of one or more comma-separated host:port pairs followed by a path, in the format of <em>host:port[,host2:port&#8230;&#8203;,hostn:port]/znode/path</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="migrating_between_source_destination_zookeepers"><a class="anchor" href="#migrating_between_source_destination_zookeepers"></a>Migrating Between Source and Destination ZooKeepers</h4>
<div class="paragraph">
<p>Before you begin, confirm that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You have installed the destination ZooKeeper cluster.</p>
</li>
<li>
<p>You have installed and configured a NiFi cluster to use the destination ZooKeeper cluster.</p>
</li>
<li>
<p>If you are migrating ZooKeepers due to upgrading NiFi from 0.x to 1.x,, you have already followed appropriate NiFi upgrade steps.</p>
</li>
<li>
<p>You have configured Kerberos as needed.</p>
</li>
<li>
<p>You have not started processing any dataflow (to avoid duplicate data processing).</p>
</li>
<li>
<p>If one of the ZooKeeper clusters you are using is configured with Kerberos, you are running the ZooKeeper Migrator from a host that has access to NiFi’s ZooKeeper client jaas configuration file (see <a href="#zk_kerberos_client">Kerberizing NiFi&#8217;s ZooKeeper Client</a> for more information).</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="zookeeper-migration-steps"><a class="anchor" href="#zookeeper-migration-steps"></a>ZooKeeper Migration Steps</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Collect the following information:</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required Information</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source ZooKeeper hostname (<strong>sourceHostname</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname must be one of the hosts running in the ZooKeeper ensemble, which can be found in &lt;NiFi installation dir&gt;/conf/zookeeper.properties.  Any of the hostnames declared in the <strong>server.N</strong> properties can be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination ZooKeeper hostname (<strong>destinationHostname</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname must be one of the hosts running in the ZooKeeper ensemble, which can be found in &lt;NiFi installation dir&gt;/conf/zookeeper.properties.  Any of the hostnames declared in the <strong>server.N</strong> properties can be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source ZooKeeper port (<strong>sourceClientPort</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This can be found in <strong>zookeeper.properties</strong> of the &lt;NiFi installation dir&gt;/conf/zookeeper.properties.  The port is specified in the <strong>clientPort</strong> property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination ZooKeeper port (<strong>destinationClientPort</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This can be found in <strong>zookeeper.properties</strong> of the &lt;NiFi installation dir&gt;/conf/zookeeper.properties.  The port is specified in the <strong>clientPort</strong> property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Export data path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determine the path that will store a json file containing the export of data from ZooKeeper.  It must be readable and writable by the user running the zk-migrator tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source ZooKeeper Authentication Information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This information is in &lt;NiFi installation dir&gt;/conf/state-management.xml. For NiFi 0.x, if Creator Only is specified in state-management.xml, you need to supply authentication information using the <code>-a,--auth</code> argument with the values from the Username and Password properties in state-management.xml. For NiFi 1.x, supply authentication information using the <code>-k,--krb-conf</code> argument.
</p><p class="tableblock">If the state-management.xml specifies Open, no authentication is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination ZooKeeper Authentication Information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This information is in &lt;NiFi installation dir&gt;/conf/state-management.xml. For NiFi 0.x, if Creator Only is specified in state-management.xml, you need to supply authentication information using the <code>-a,--auth</code> argument with the values from the Username and Password properties in state-management.xml. For NiFi 1.x, supply authentication information using the <code>-k,--krb-conf</code> argument.
</p><p class="tableblock">If the state-management.xml specifies Open, no authentication is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root path to which NiFi writes data in Source ZooKeeper (<strong>sourceRootPath</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This information can be found in &lt;NiFi installation dir&gt;/conf/state-management.xml under the Root Node property in the cluster-provider element. (default: /nifi)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root path to which NiFi writes data in Destination ZooKeeper (<strong>destinationRootPath</strong>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This information can be found in &lt;NiFi installation dir&gt;/conf/state-management.xml under the Root Node property in the cluster-provider element.</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Stop all processors in the NiFi flow.  If you are migrating between two NiFi installations, the flows on both must be stopped.</p>
</li>
<li>
<p>Export the NiFi component data from the source ZooKeeper.  The following command reads from the specified ZooKeeper running on the given hostname:port, using the provided path to the data, and authenticates with ZooKeeper using the given username and password.  The data read from ZooKeeper is written to the file provided.</p>
<div class="ulist">
<ul>
<li>
<p>For NiFi 0.x</p>
<div class="ulist">
<ul>
<li>
<p>For an open ZooKeeper:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>sourceHostname:sourceClientPort</strong>/<strong>sourceRootPath</strong>/components -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>For a ZooKeeper using username:password for authentication:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>sourceHostname:sourceClientPort</strong>/<strong>sourceRootPath</strong>/components -a &lt;username:password&gt; -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>For NiFi 1.x</p>
<div class="ulist">
<ul>
<li>
<p>For an open ZooKeeper:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>sourceHostname:sourceClientPort</strong>/<strong>sourceRootPath</strong>/components -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>For a ZooKeeper using Kerberos for authentication:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>sourceHostname:sourceClientPort</strong>/<strong>sourceRootPath</strong>/components -k /<strong>path</strong>/<strong>to</strong>/<strong>jaasconfig</strong>/<strong>jaas-config.conf</strong> -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>(Optional) If you have used the  new NiFi installation to do any processing, you can also export its ZooKeeper data as a backup prior to performing the migration.</p>
<div class="ulist">
<ul>
<li>
<p>For an open ZooKeeper:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>destinationHostname:destinationClientPort</strong>/<strong>destinationRootPath</strong>/components -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-destination-backup-data.json</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>For a ZooKeeper using Kerberos for authentication:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -r -z <strong>destinationHostname:destinationClientPort</strong>/<strong>destinationRootPath</strong>/components -k /<strong>path</strong>/<strong>to</strong>/<strong>jaasconfig</strong>/<strong>jaas-config.conf</strong> -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-destination-backup-data.json</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Migrate the ZooKeeper data to the destination ZooKeeper. If the source and destination ZooKeepers are the same, the <code>--ignore-source</code> option can be added to the following examples.</p>
<div class="ulist">
<ul>
<li>
<p>For an open ZooKeeper:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -s -z <strong>destinationHostname:destinationClientPort</strong>/<strong>destinationRootPath</strong>/components -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>For a ZooKeeper using Kerberos for authentication:</p>
<div class="ulist">
<ul>
<li>
<p>zk-migrator.sh -s -z <strong>destinationHostname:destinationClientPort</strong>/<strong>destinationRootPath</strong>/components -k /<strong>path</strong>/<strong>to</strong>/<strong>jaasconfig</strong>/<strong>jaas-config.conf</strong> -f /<strong>path</strong>/<strong>to</strong>/<strong>export</strong>/<strong>zk-source-data.json</strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Once the migration has completed successfully, start the processors in the NiFi flow.  Processing should continue from the point at which it was stopped when the NiFi flow was stopped.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrap_properties"><a class="anchor" href="#bootstrap_properties"></a>Bootstrap Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>bootstrap.conf</em> file in the <em>conf</em> directory allows users to configure settings for how NiFi should be started.
This includes parameters, such as the size of the Java Heap, what Java command to run, and Java System Properties.</p>
</div>
<div class="paragraph">
<p>Here, we will address the different properties that are made available in the file. Any changes to this file will
take effect only after NiFi has been stopped and restarted.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the fully qualified java command to run. By default, it is simply <code>java</code> but could be changed to an absolute path or a reference an environment variable, such as <code>$JAVA_HOME/bin/java</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">run.as</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to run NiFi as. For instance, if NiFi should be run as the <em>nifi</em> user, setting this value to <em>nifi</em> will cause the NiFi Process to be run as the <em>nifi</em> user.
        This property is ignored on Windows. For Linux, the specified user may require sudo permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lib.dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>lib</em> directory to use for NiFi. By default, this is set to <code>./lib</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">conf.dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>conf</em> directory to use for NiFi. By default, this is set to <code>./conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">graceful.shutdown.seconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When NiFi is instructed to shutdown, the Bootstrap will wait this number of seconds for the process to shutdown cleanly. At this amount of time,
                           if the service is still running, the Bootstrap will "kill" the process, or terminate it abruptly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.arg.N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any number of JVM arguments can be passed to the NiFi JVM when the process is started. These arguments are defined by adding properties to <em>bootstrap.conf</em> that
            begin with <code>java.arg.</code>. The rest of the property name is not relevant, other than to different property names, and will be ignored. The default includes
            properties for minimum and maximum Java Heap size, the garbage collector to use, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notification.services.file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When NiFi is started, or stopped, or when the Bootstrap detects that NiFi has died, the Bootstrap is able to send notifications of these events
                            to interested parties. This is configured by specifying an XML file that defines which notification services can be used. More about this
                            file can be found in the <a href="#notification_services">Notification Services</a> section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notification.max.attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a notification service is configured but is unable to perform its function, it will try again up to a maximum number of attempts. This property
                           configures what that maximum number of attempts is. The default value is <code>5</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.start.notification.services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property is a comma-separated list of Notification Service identifiers that correspond to the Notification Services
                                  defined in the <code>notification.services.file</code> property. The services with the specified identifiers will be used to notify their
                                  configured recipients whenever NiFi is started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.stop.notification.services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property is a comma-separated list of Notification Service identifiers that correspond to the Notification Services
                                 defined in the <code>notification.services.file</code> property. The services with the specified identifiers will be used to notify their
                                 configured recipients whenever NiFi is stopped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.died.notification.services</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property is a comma-separated list of Notification Service identifiers that correspond to the Notification Services
                                 defined in the <code>notification.services.file</code> property. The services with the specified identifiers will be used to notify their
                                 configured recipients if the bootstrap determines that NiFi has unexpectedly died.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="notification_services"><a class="anchor" href="#notification_services"></a>Notification Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the NiFi bootstrap starts or stops NiFi, or detects that it has died unexpectedly, it is able to notify configured recipients. Currently,
the only mechanisms supplied are to send an e-mail or HTTP POST notification. The notification services configuration file
is an XML file where the notification capabilities are configured.</p>
</div>
<div class="paragraph">
<p>The default location of the XML file is <em>conf/bootstrap-notification-services.xml</em>, but this value can be changed in the <em>conf/bootstrap.conf</em> file.</p>
</div>
<div class="paragraph">
<p>The syntax of the XML file is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;services&gt;
    &lt;!-- any number of service elements can be defined. --&gt;
    &lt;service&gt;
        &lt;id&gt;some-identifier&lt;/id&gt;
        &lt;!-- The fully-qualified class name of the Notification Service. --&gt;
        &lt;class&gt;org.apache.nifi.bootstrap.notification.email.EmailNotificationService&lt;/class&gt;

        &lt;!-- Any number of properties can be set using this syntax.
             The properties available depend on the Notification Service. --&gt;
        &lt;property name="Property Name 1"&gt;Property Value&lt;/property&gt;
        &lt;property name="Another Property Name"&gt;Property Value 2&lt;/property&gt;
    &lt;/service&gt;
&lt;/services&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Once the desired services have been configured, they can then be referenced in the <em>bootstrap.conf</em> file.</p>
</div>
<div class="sect2">
<h3 id="email-notification-service-br"><a class="anchor" href="#email-notification-service-br"></a>Email Notification Service<br></h3>
<div class="paragraph">
<p>The first Notifier is to send emails and the implementation is <code>org.apache.nifi.bootstrap.notification.email.EmailNotificationService</code>.
It has the following properties available:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname of the SMTP Server that is used to send Email Notifications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Port used for SMTP communications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for the SMTP account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for the SMTP account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Auth</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag indicating whether authentication should be used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP TLS</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flag indicating whether TLS should be enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Socket Factory</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.net.ssl.SSLSocketFactory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP X-Mailer Header</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X-Mailer used in the header of the outgoing email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mime Type used to interpret the contents of the email, such as text/plain or text/html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">From</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the Email address to use as the sender. Otherwise, a "friendly name" can be used as the From address, but the value
           must be enclosed in double-quotes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">To</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The recipients to include in the To-Line of the email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CC</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The recipients to include in the CC-Line of the email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BCC</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The recipients to include in the BCC-Line of the email</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the properties above that are marked as required, at least one of the <code>To</code>, <code>CC</code>, or <code>BCC</code> properties
must be set.</p>
</div>
<div class="paragraph">
<p>A complete example of configuring the Email service would look like the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>     &lt;service&gt;
        &lt;id&gt;email-notification&lt;/id&gt;
        &lt;class&gt;org.apache.nifi.bootstrap.notification.email.EmailNotificationService&lt;/class&gt;
        &lt;property name="SMTP Hostname"&gt;smtp.gmail.com&lt;/property&gt;
        &lt;property name="SMTP Port"&gt;587&lt;/property&gt;
        &lt;property name="SMTP Username"&gt;username@gmail.com&lt;/property&gt;
        &lt;property name="SMTP Password"&gt;super-secret-password&lt;/property&gt;
        &lt;property name="SMTP TLS"&gt;true&lt;/property&gt;
        &lt;property name="From"&gt;"NiFi Service Notifier"&lt;/property&gt;
        &lt;property name="To"&gt;username@gmail.com&lt;/property&gt;
     &lt;/service&gt;</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-notification-service-br"><a class="anchor" href="#http-notification-service-br"></a>HTTP Notification Service<br></h3>
<div class="paragraph">
<p>The second Notifier is to send HTTP POST requests and the implementation is <code>org.apache.nifi.bootstrap.notification.http.HttpNotificationService</code>.
It has the following properties available:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL to send the notification to. Expression language is supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max wait time for connection to remote service. Expression language is supported. This defaults to 10s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write timeout</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max wait time for remote service to read the request sent. Expression language is supported. This defaults to 10s.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truststore Filename</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully-qualified filename of the Truststore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truststore Type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Type of the Truststore. Either JKS or PKCS12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Truststore Password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Truststore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore Filename</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully-qualified filename of the Keystore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore Type</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the Keystore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keystore Password</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password for the key. If this is not specified, but the Keystore Filename, Password, and Type are specified, then the Keystore Password will be assumed to be the same as the Key Password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL Protocol</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The algorithm to use for this SSL context. This can either be "SSL" or "TLS".</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the properties above, dynamic properties can be added. They will be added as headers to the HTTP request. Expression language is supported.</p>
</div>
<div class="paragraph">
<p>The notification message is in the body of the POST request. The type of notification is in the header "notification.type" and the subject uses the header "notification.subject".</p>
</div>
<div class="paragraph">
<p>A complete example of configuring the HTTP service could look like the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>     &lt;service&gt;
        &lt;id&gt;http-notification&lt;/id&gt;
        &lt;class&gt;org.apache.nifi.bootstrap.notification.http.HttpNotificationService&lt;/class&gt;
        &lt;property name="URL"&gt;https://testServer.com:8080/&lt;/property&gt;
        &lt;property name="Truststore Filename"&gt;localhost-ts.jks&lt;/property&gt;
        &lt;property name="Truststore Type"&gt;JKS&lt;/property&gt;
        &lt;property name="Truststore Password"&gt;localtest&lt;property&gt;
        &lt;property name="Keystore Filename"&gt;localhost-ts.jks&lt;/property&gt;
        &lt;property name="Keystore Type"&gt;JKS&lt;/property&gt;
        &lt;property name="Keystore Password"&gt;localtest&lt;/property&gt;
        &lt;property name="notification.timestamp"&gt;${now()}&lt;/property&gt;
     &lt;/service&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kerberos_service"><a class="anchor" href="#kerberos_service"></a>Kerberos Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>NiFi can be configured to use Kerberos SPNEGO (or "Kerberos Service") for authentication. In this scenario, users will hit the REST endpoint <code>/access/kerberos</code> and the server will respond with a <code>401</code> status code and the challenge response header <code>WWW-Authenticate: Negotiate</code>. This communicates to the browser to use the GSS-API and load the user&#8217;s Kerberos ticket and provide it as a Base64-encoded header value in the subsequent request. It will be of the form <code>Authorization: Negotiate YII...</code>. NiFi will attempt to validate this ticket with the KDC. If it is successful, the user&#8217;s <em>principal</em> will be returned as the identity, and the flow will follow login/credential authentication, in that a JWT will be issued in the response to prevent the unnecessary overhead of Kerberos authentication on every subsequent request. If the ticket cannot be validated, it will return with the appropriate error response code. The user will then be able to provide their Kerberos credentials to the login form if the <code>KerberosLoginIdentityProvider</code> has been configured. See <a href="#kerberos_login_identity_provider">Kerberos</a> login identity provider for more details.</p>
</div>
<div class="paragraph">
<p>NiFi will only respond to Kerberos SPNEGO negotiation over an HTTPS connection, as unsecured requests are never authenticated.</p>
</div>
<div class="paragraph">
<p>The following properties must be set in <em>nifi.properties</em> to enable Kerberos service authentication.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Principal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service principal used by NiFi to communicate with the KDC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keytab Location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file path to the keytab containing the service principal</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <a href="#kerberos_properties">Kerberos Properties</a> for complete documentation.</p>
</div>
<div class="sect2">
<h3 id="kerberos_service_notes"><a class="anchor" href="#kerberos_service_notes"></a>Notes</h3>
<div class="ulist">
<ul>
<li>
<p>Kerberos is case-sensitive in many places and the error messages (or lack thereof) may not be sufficiently explanatory. Check the case sensitivity of the service principal in your configuration files. Convention is <code>HTTP/fully.qualified.domain@REALM</code>.</p>
</li>
<li>
<p>Browsers have varying levels of restriction when dealing with SPNEGO negotiations. Some will provide the local Kerberos ticket to any domain that requests it, while others whitelist the trusted domains. See <a href="http://docs.spring.io/autorepo/docs/spring-security-kerberos/1.0.2.BUILD-SNAPSHOT/reference/htmlsingle/#browserspnegoconfig">Spring Security Kerberos - Reference Documentation: Appendix E. Configure browsers for SPNEGO Negotiation</a> for common browsers.</p>
</li>
<li>
<p>Some browsers (legacy IE) do not support recent encryption algorithms such as AES, and are restricted to legacy algorithms (DES). This should be noted when generating keytabs.</p>
</li>
<li>
<p>The KDC must be configured and a service principal defined for NiFi and a keytab exported. Comprehensive instructions for Kerberos server configuration and administration are beyond the scope of this document (see <a href="http://web.mit.edu/kerberos/krb5-current/doc/admin/index.html">MIT Kerberos Admin Guide</a>), but an example is below:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Adding a service principal for a server at <code>nifi.nifi.apache.org</code> and exporting the keytab from the KDC:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>root@kdc:/etc/krb5kdc# kadmin.local
Authenticating as principal admin/admin@NIFI.APACHE.ORG with password.
kadmin.local:  listprincs
K/M@NIFI.APACHE.ORG
admin/admin@NIFI.APACHE.ORG
...
kadmin.local:  addprinc -randkey HTTP/nifi.nifi.apache.org
WARNING: no policy specified for HTTP/nifi.nifi.apache.org@NIFI.APACHE.ORG; defaulting to no policy
Principal "HTTP/nifi.nifi.apache.org@NIFI.APACHE.ORG" created.
kadmin.local:  ktadd -k /http-nifi.keytab HTTP/nifi.nifi.apache.org
Entry for principal HTTP/nifi.nifi.apache.org with kvno 2, encryption type des3-cbc-sha1 added to keytab WRFILE:/http-nifi.keytab.
Entry for principal HTTP/nifi.nifi.apache.org with kvno 2, encryption type des-cbc-crc added to keytab WRFILE:/http-nifi.keytab.
kadmin.local:  listprincs
HTTP/nifi.nifi.apache.org@NIFI.APACHE.ORG
K/M@NIFI.APACHE.ORG
admin/admin@NIFI.APACHE.ORG
...
kadmin.local: q
root@kdc:~# ll /http*
-rw------- 1 root root 162 Mar 14 21:43 /http-nifi.keytab
root@kdc:~#</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="system_properties"><a class="anchor" href="#system_properties"></a>System Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <em>nifi.properties</em> file in the <em>conf</em> directory is the main configuration file for controlling how NiFi runs. This section provides an overview of the properties in this file and includes some notes on how to configure it in a way that will make upgrading easier. <strong>After making changes to this file, restart NiFi in order
for the changes to take effect.</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The contents of this file are relatively stable but do change from time to time. It is always a good idea to
review this file when upgrading and pay attention for any changes. Consider configuring items
below marked with an asterisk (*) in such a way that upgrading will be easier. For details, see a full discussion on upgrading
at the end of this section. Note that values for periods of time and data sizes must include the unit of measure,
for example "10 secs" or "10 MB", not simply "10".
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="core-properties-br"><a class="anchor" href="#core-properties-br"></a>Core Properties<br></h3>
<div class="paragraph">
<p>The first section of the <em>nifi.properties</em> file is for the Core Properties. These properties apply to the core framework as a whole.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.file*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the flow configuration file (i.e., the file that contains what is currently displayed on the NiFi graph). The default value is <code>./conf/flow.xml.gz</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.archive.enabled*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether NiFi creates a backup copy of the flow automatically when the flow is updated. The default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.archive.dir*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the archive directory where backup copies of the flow.xml are saved. The default value is <code>./conf/archive</code>. NiFi removes old archive files to limit disk usage based on archived file lifespan, total size, and number of files, as specified with <code>nifi.flow.configuration.archive.max.time</code>, <code>max.storage</code> and <code>max.count</code> properties respectively. If none of these limitation for archiving is specified, NiFi uses default condition, that is "30 days" for max.time and "500 MB" for max.storage.<br>
This cleanup mechanism takes into account only automatically created archived flow.xml files. If there are other files or directories in this archive directory, NiFi will ignore them. Automatically created archives have filename with ISO 8601 format timestamp prefix followed by <em><em>&lt;original-filename&gt;</em>. That is &lt;year&gt;&lt;month&gt;&lt;day&gt;T&lt;hour&gt;&lt;minute&gt;&lt;second&gt;+&lt;timezone offset&gt;</em>&lt;original filename&gt;. For example, <code>20160706T160719+0900_flow.xml.gz</code>. NiFi checks filenames when it cleans archive directory. If you would like to keep a particular archive in this directory without worrying about NiFi deleting it, you can do so by copying it with a different filename pattern.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.archive.max.time*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The lifespan of archived flow.xml files. NiFi will delete expired archive files when it updates flow.xml if this property is specified. Expiration is determined based on current system time and the last modified timestamp of an archived flow.xml. If no archive limitation is specified in nifi.properties, NiFi removes archives older than "30 days".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.archive.max.storage*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total data size allowed for the archived flow.xml files. NiFi will delete the oldest archive files until the total archived file size becomes less than this configuration value, if this property is specified. If no archive limitation is specified in nifi.properties, NiFi uses "500 MB" for this.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flow.configuration.archive.max.count*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of archive files allowed. NiFi will delete the oldest archive files so that only N latest archives can be kept, if this property is specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowcontroller.autoResumeState</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether -upon restart- the components on the NiFi graph should return to their last state. The default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowcontroller.graceful.shutdown.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the shutdown period. The default value is <code>10 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowservice.writedelay.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When many changes are made to the flow.xml, this property specifies how long to wait before writing out the changes, so as to batch the changes into a single write. The default value is <code>500 ms</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.administrative.yield.duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a component allows an unexpected exception to escape, it is considered a bug. As a result, the framework will pause (or administratively yield) the component for this amount of time. This is done so that the component does not use up massive amounts of system resources, since it is known to have problems in the existing state. The default value is <code>30 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.bored.yield.duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When a component has no work to do (i.e., is "bored"), this is the amount of time it will wait before checking to see if it has new data to work on. This way, it does not use up CPU resources by checking for new work too often. When setting this property, be aware that it could add extra latency for components that do not constantly have work to do, as once they go into this "bored" state, they will wait this amount of time before checking for more work. The default value is <code>10 ms</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.authorizer.configuration.file*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the location of the file that specifies how authorizers are defined.  The default value is <code>./conf/authorizers.xml</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.login.identity.provider.configuration.file*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the location of the file that specifies how username/password authentication is performed. This file is
only considered if <code>nifi.security.user.login.identity.provider</code> is configured with a provider identifier. The default value is <code>./conf/login-identity-providers.xml</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.templates.directory*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the location of the directory where flow templates are saved (for backward compatibility only).  Templates are stored in the flow.xml.gz starting with NiFi 1.0. The template directory can be used to (bulk) import templates into the flow.xml.gz automatically on NiFi startup.  The default value is <code>./conf/templates</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.ui.banner.text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is banner text that may be configured to display at the top of the User Interface. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.ui.autorefresh.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval at which the User Interface auto-refreshes. The default value is <code>30 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.nar.library.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the nar library. The default value is <code>./lib</code> and probably should be left as is.<br>
<br>
<strong>NOTE</strong>: Additional library directories can be specified by using the <strong><em>nifi.nar.library.directory.</em></strong> prefix with unique suffixes and separate paths as values.<br>
<br>
For example, to provide two additional library locations, a user could also specify additional properties with keys of:<br>
<br>
nifi.nar.library.directory.lib1=/nars/lib1<br>
nifi.nar.library.directory.lib2=/nars/lib2<br>
<br>
Providing three total locations, including  <code>nifi.nar.library.directory</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.nar.working.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the nar working directory. The default value is <code>./work/nar</code> and probably should be left as is.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.documentation.working.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The documentation working directory. The default value is <code>./work/docs/components</code> and probably should be left as is.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.processor.scheduling.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to wait for a Processor&#8217;s life-cycle operation (@OnScheduled and @OnUnscheduled) to finish before other life-cycle operation (e.g., stop) could be invoked. The default value is <code>1 min</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="state-management-br"><a class="anchor" href="#state-management-br"></a>State Management<br></h3>
<div class="paragraph">
<p>The State Management section of the Properties file provides a mechanism for configuring local and cluster-wide mechanisms
for components to persist state. See the <a href="#state_management">State Management</a> section for more information on how this is used.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.configuration.file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The XML file that contains configuration for the local and cluster-wide State Providers. The default value is <code>./conf/state-management.xml</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.provider.local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the Local State Provider to use. This value must match the value of the <code>id</code> element of one of the <code>local-provider</code> elements in the <em>state-management.xml</em> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.provider.cluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the Cluster State Provider to use. This value must match the value of the <code>id</code> element of one of the <code>cluster-provider</code> elements in the <em>state-management.xml</em> file. This value is ignored if not clustered but is required for nodes in a cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.embedded.zookeeper.start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether or not this instance of NiFi should start an embedded ZooKeeper Server. This is used in conjunction with the ZooKeeperStateProvider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.state.management.embedded.zookeeper.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies a properties file that contains the configuration for the embedded ZooKeeper Server that is started (if the <code>nifi.state.management.embedded.zookeeper.start</code> property is set to <code>true</code>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="h2-settings"><a class="anchor" href="#h2-settings"></a>H2 Settings</h3>
<div class="paragraph">
<p>The H2 Settings section defines the settings for the H2 database, which keeps track of user access and flow controller history.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.database.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the H2 database directory. The default value is <code>./database_repository</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.h2.url.append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property specifies additional arguments to add to the connection string for the H2 database. The default value should be used and should not be changed. It is: <code>;LOCK_TIMEOUT=25000;WRITE_DELAY=0;AUTO_SERVER=FALSE</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="flowfile-repository"><a class="anchor" href="#flowfile-repository"></a>FlowFile Repository</h3>
<div class="paragraph">
<p>The FlowFile repository keeps track of the attributes and current state of each FlowFile in the system. By default,
this repository is installed in the same root installation directory as all the other repositories; however, it is advisable
to configure it on a separate drive if available.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowfile.repository.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FlowFile Repository implementation. The default value is <code>org.apache.nifi.controller.repository.WriteAheadFlowFileRepository</code> and should only be changed with caution. To store flowfiles in memory instead of on disk (at the risk of data loss in the event of power/machine failure), set this property to <code>org.apache.nifi.controller.repository.VolatileFlowFileRepository</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowfile.repository.directory*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the FlowFile Repository. The default value is <code>./flowfile_repository</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowfile.repository.partitions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of partitions. The default value is <code>256</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowfile.repository.checkpoint.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The FlowFile Repository checkpoint interval. The default value is <code>2 mins</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.flowfile.repository.always.sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system not to cache the information. This is very expensive and can significantly reduce NiFi performance. However, if it is <code>false</code>, there could be the potential for data loss if either there is a sudden power loss or the operating system crashes. The default value is <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="swap-management"><a class="anchor" href="#swap-management"></a>Swap Management</h3>
<div class="paragraph">
<p>NiFi keeps FlowFile information in memory (the JVM)
but during surges of incoming data, the FlowFile information can start to take up so much of the JVM that system performance
suffers. To counteract this effect, NiFi "swaps" the FlowFile information to disk temporarily until more JVM space becomes
available again. These properties govern how that process occurs.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.swap.manager.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Swap Manager implementation. The default value is <code>org.apache.nifi.controller.FileSystemSwapManager</code> and should not be changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.queue.swap.threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The queue threshold at which NiFi starts to swap FlowFile information to disk. The default value is <code>20000</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.swap.in.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The swap in period. The default value is <code>5 sec</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.swap.in.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for swapping in. The default value is <code>1</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.swap.out.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The swap out period. The default value is <code>5 sec</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.swap.out.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for swapping out. The default value is <code>4</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="content-repository"><a class="anchor" href="#content-repository"></a>Content Repository</h3>
<div class="paragraph">
<p>The Content Repository holds the content for all the FlowFiles in the system. By default, it is installed in the same root
installation directory as all the other repositories; however, administrators will likely want to configure it on a separate
drive if available. If nothing else, it is best if the Content Repository is not on the same drive as the FlowFile Repository.
In dataflows that handle a large amount of data, the Content Repository could fill up a disk and the
FlowFile Repository, if also on that disk, could become corrupt. To avoid this situation, configure these repositories on different drives.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Content Repository implementation. The default value is <code>org.apache.nifi.controller.repository.FileSystemRepository</code> and should only be changed with caution. To store flowfile content in memory instead of on disk (at the risk of data loss in the event of power/machine failure), set this property to <code>org.apache.nifi.controller.repository.VolatileContentRepository</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="file-system-content-repository-properties"><a class="anchor" href="#file-system-content-repository-properties"></a>File System Content Repository Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Content Repository implementation. The default value is <code>org.apache.nifi.controller.repository.FileSystemRepository</code> and should only be changed with caution. To store flowfile content in memory instead of on disk (at the risk of data loss in the event of power/machine failure), set this property to <code>org.apache.nifi.controller.repository.VolatileContentRepository</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.claim.max.appendable.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size for a content claim. The default value is <code>10 MB</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.claim.max.flow.files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of FlowFiles to assign to one content claim. The default value is <code>100</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.directory.default*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the Content Repository. The default value is <code>./content_repository</code>.<br>
<br>
<strong>NOTE</strong>: Multiple content repositories can be specified by using the <strong><em>nifi.content.repository.directory.</em></strong> prefix with unique suffixes and separate paths as values.<br>
<br>
For example, to provide two additional locations to act as part of the content repository, a user could also specify additional properties with keys of:<br>
<br>
nifi.content.repository.directory.content1=/repos/content1<br>
nifi.content.repository.directory.content2=/repos/content2<br>
<br>
Providing three total locations, including  <code>nifi.content.repository.directory.default</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.archive.max.retention.period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If archiving is enabled (see nifi.content.repository.archive.enabled below), then
this property specifies the maximum amount of time to keep the archived data. The default value is <code>12 hours</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.archive.max.usage.percentage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If archiving is enabled (see nifi.content.repository.archive.enabled below), then this property must have a value that indicates the content repository disk usage percentage at which archived data begins to be removed. If the archive is empty and content repository disk usage is above this percentage, then archiving is temporarily disabled. Archiving will resume when disk usage is below this percentage. The default value is <code>50%</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.archive.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To enable content archiving, set this to <em>true</em> and specify a value for the <code>nifi.content.repository.archive.max.usage.percentage</code> property above. Content archiving enables the provenance UI to view or replay content that is no longer in a dataflow queue. By default, archiving is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.repository.always.sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system not to cache the information. This is very expensive and can significantly reduce NiFi performance. However, if it is <code>false</code>, there could be the potential for data loss if either there is a sudden power loss or the operating system crashes. The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.content.viewer.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL for a web-based content viewer if one is available. It is blank by default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="volatile-content-repository-properties"><a class="anchor" href="#volatile-content-repository-properties"></a>Volatile Content Repository Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.volatile.content.repository.max.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Content Repository maximum size in memory. The default value is <code>100 MB</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.volatile.content.repository.block.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Content Repository block size. The default value is <code>32 KB</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="provenance-repository"><a class="anchor" href="#provenance-repository"></a>Provenance Repository</h3>
<div class="paragraph">
<p>The Provenance Repository contains the information related to Data Provenance. The next four sections are for Provenance Repository properties.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Provenance Repository implementation. The default value is <code>org.apache.nifi.provenance.PersistentProvenanceRepository</code>.
Two additional repositories are available as well.
To store provenance events in memory instead of on disk (in which case all events will be lost on restart, and events will be evicted in a first-in-first-out order),
set this property to <code>org.apache.nifi.provenance.VolatileProvenanceRepository</code>. This leaves a configurable number of Provenance Events in the Java heap, so the number
of events that can be retained is very limited.
</p><p class="tableblock">As of Apache NiFi 1.2.0, a third and fourth option are available: <code>org.apache.nifi.provenance.WriteAheadProvenanceRepository</code> and <code>org.apache.nifi.provenance.EncryptedWriteAheadProvenanceRepository</code>.
This implementation was created to replace the <code>PersistentProvenanceRepository</code>. The <code>PersistentProvenanceRepository</code> was originally written with the simple goal of persisting
Provenance Events as they are generated and providing the ability to iterate over those events sequentially. Later, it was desired to be able to compress the data so that
more data could be stored. After that, the ability to index and query the data was added. As requirements evolved over time, the repository kept changing without any major
redesigns. When used in a NiFi instance that is responsible for processing large volumes of small FlowFiles, the <code>PersistentProvenanceRepository</code> can quickly become a bottleneck.
The <code>WriteAheadProvenanceRepository</code> was then written to provide the same capabilities as the <code>PersistentProvenanceRepository</code> while providing far better performance.
Changing to the <code>WriteAheadProvenanceRepository</code> is easy to accomplish, as the two repositories support most of the same properties.
</p><p class="tableblock"><strong>Note Well</strong>, however, the following caveat: The <code>WriteAheadProvenanceRepository</code> will make use of the Provenance data stored by the <code>PersistentProvenanceRepository</code>. However, the
<code>PersistentProvenanceRepository</code> may not be able to read the data written by the <code>WriteAheadProvenanceRepository</code>. Therefore, once the Provenance Repository is changed to use
the <code>WriteAheadProvenanceRepository</code>, it cannot be changed back to the <code>PersistentProvenanceRepository</code> without deleting the data in the Provenance Repository. It is therefore
recommended that before changing the implementation, users ensure that their version of NiFi is stable, in case any issue arises that causes the user to need to roll back to
a previous version of NiFi that did not support the <code>WriteAheadProvenanceRepository</code>. It is for this reason that the default is still set to the <code>PersistentProvenanceRepository</code>
at this time.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="persistent-provenance-repository-properties"><a class="anchor" href="#persistent-provenance-repository-properties"></a>Persistent Provenance Repository Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.directory.default*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the Provenance Repository. The default value is <code>./provenance_repository</code>.<br>
<br>
<strong>NOTE</strong>: Multiple provenance repositories can be specified by using the <strong><em>nifi.provenance.repository.directory.</em></strong> prefix with unique suffixes and separate paths as values.<br>
<br>
For example, to provide two additional locations to act as part of the provenance repository, a user could also specify additional properties with keys of:<br>
<br>
nifi.provenance.repository.directory.provenance1=/repos/provenance1<br>
nifi.provenance.repository.directory.provenance2=/repos/provenance2<br>
<br>
Providing three total locations, including <code>nifi.provenance.repository.directory.default</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.storage.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of time to keep data provenance information. The default value is <code>24 hours</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.storage.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of data provenance information to store at a time. The default value is <code>1 GB</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.rollover.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time to wait before rolling over the latest data provenance information so that it is available in the User Interface. The default value is <code>30 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.rollover.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of information to roll over at a time. The default value is <code>100 MB</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.query.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for Provenance Repository queries. The default value is <code>2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.index.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for indexing Provenance events so that they are searchable. The default value is <code>1</code>.
	For flows that operate on a very high number of FlowFiles, the indexing of Provenance events could become a bottleneck. If this is the case, a bulletin will appear, indicating that
	"The rate of the dataflow is exceeding the provenance recording rate. Slowing down flow to accommodate." If this happens, increasing the value of this property
	may increase the rate at which the Provenance Repository is able to process these records, resulting in better overall throughput.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.compress.on.rollover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether to compress the provenance information when rolling it over. The default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.always.sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system not to cache the information. This is very expensive and can significantly reduce NiFi performance. However, if it is <code>false</code>, there could be the potential for data loss if either there is a sudden power loss or the operating system crashes. The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.journal.count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of journal files that should be used to serialize Provenance Event data. Increasing this value will allow more tasks to simultaneously update the repository but will result in more expensive merging of the journal files later. This value should ideally be equal to the number of threads that are expected to update the repository simultaneously, but 16 tends to work well in must environments. The default value is <code>16</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.indexed.fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a comma-separated list of the fields that should be indexed and made searchable. Fields that are not indexed will not be searchable. Valid fields are: <code>EventType, FlowFileUUID, Filename, TransitURI, ProcessorID, AlternateIdentifierURI, Relationship, Details</code>. The default value is: <code>EventType, FlowFileUUID, Filename, ProcessorID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.indexed.attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a comma-separated list of FlowFile Attributes that should be indexed and made searchable. It is blank by default.  But some good examples to consider are <em>filename</em>, <em>uuid</em>, and <em>mime.type</em> as well as any custom attritubes you might use which are valuable for your use case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.index.shard.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large values for the shard size will result in more Java heap usage when searching the Provenance Repository but should provide better performance. The default value is <code>500 MB</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.attribute.length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the maximum length that a FlowFile attribute can be when retrieving a Provenance Event from the repository. If the length of any attribute exceeds this value, it will be truncated when the event is retrieved. The default value is <code>65536</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="volatile-provenance-repository-properties"><a class="anchor" href="#volatile-provenance-repository-properties"></a>Volatile Provenance Repository Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.buffer.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Provenance Repository buffer size. The default value is <code>100000</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="write-ahead-provenance-repository-properties"><a class="anchor" href="#write-ahead-provenance-repository-properties"></a>Write Ahead Provenance Repository Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.directory.default*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the Provenance Repository. The default value is <code>./provenance_repository</code>.<br>
<br>
	<strong>NOTE</strong>: Multiple provenance repositories can be specified by using the <strong><em>nifi.provenance.repository.directory.</em></strong> prefix with unique suffixes and separate paths as values.<br>
<br>
	For example, to provide two additional locations to act as part of the provenance repository, a user could also specify additional properties with keys of:<br>
<br>
	nifi.provenance.repository.directory.provenance1=/repos/provenance1<br>
	nifi.provenance.repository.directory.provenance2=/repos/provenance2<br>
<br>
	Providing three total locations, including <code>nifi.provenance.repository.directory.default</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.storage.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of time to keep data provenance information. The default value is <code>24 hours</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.storage.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of data provenance information to store at a time.
	The default value is <code>1 GB</code>. The Data Provenance capability can consume a great deal of storage space because so much data is kept.
	For production environments, values of 1-2 TB or more is not uncommon. The repository will write to a single "event file" (or set of
	"event files" if multiple storage locations are defined, as described above) for some period of time (defined by the
	nifi.provenance.repository.rollover.time and  nifi.provenance.repository.rollover.size properties). Data is always aged off one file at a time,
	so it is not advisable to write to a single "event file" for a tremendous amount of time, as it will prevent old data from aging off as smoothly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.rollover.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time to wait before rolling over the "event file" that the repository is writing to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.rollover.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of data to write to a single "event file." The default value is <code>100 MB</code>. For production
	environments where a very large amount of Data Provenance is generated, a value of 1 GB is also very reasonable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.query.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for Provenance Repository queries. The default value is <code>2</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.index.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads to use for indexing Provenance events so that they are searchable. The default value is <code>1</code>.
	For flows that operate on a very high number of FlowFiles, the indexing of Provenance events could become a bottleneck. If this happens, increasing the
	value of this property may increase the rate at which the Provenance Repository is able to process these records, resulting in better overall throughput.
	It is advisable to use at least 1 thread per storage location (i.e., if there are 3 storage locations, at least 3 threads should be used). For high
	throughput environments, where more CPU and disk I/O is available, it may make sense to increase this value significantly. Typically going beyond
	2-4 threads per storage location is not valuable. However, this can be tuned depending on the CPU resources available compared to the I/O resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.compress.on.rollover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether to compress the provenance information when an "event file" is rolled over. The default value is <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.always.sync</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to <code>true</code>, any change to the repository will be synchronized to the disk, meaning that NiFi will ask the operating system
	not to cache the information. This is very expensive and can significantly reduce NiFi performance. However, if it is <code>false</code>, there could be the potential for data
	loss if either there is a sudden power loss or the operating system crashes. The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.indexed.fields</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a comma-separated list of the fields that should be indexed and made searchable.
	Fields that are not indexed will not be searchable. Valid fields are: <code>EventType, FlowFileUUID, Filename, TransitURI, ProcessorID,
	AlternateIdentifierURI, Relationship, Details</code>. The default value is: <code>EventType, FlowFileUUID, Filename, ProcessorID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.indexed.attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a comma-separated list of FlowFile Attributes that should be indexed and made searchable. It is blank by default.
	But some good examples to consider are <em>filename</em> and <em>mime.type</em> as well as any custom attributes you might use which are valuable for your use case.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.index.shard.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The repository uses Apache Lucene to performing indexing and searching capabilities. This value indicates how large a Lucene Index should
	become before the Repository starts writing to a new Index. Large values for the shard size will result in more Java heap usage when searching the Provenance Repository but should
	provide better performance. The default value is <code>500 MB</code>. However, this is due to the fact that defaults are tuned for very small environments where most users begin to use NiFi.
	For production environments, it is advisable to change this value to <strong>4 to 8 GB</strong>. Once all Provenance Events in the index have been aged off from the "event files," the index
	will be destroyed as well.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.max.attribute.length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates the maximum length that a FlowFile attribute can be when retrieving a Provenance Event from the repository.
	If the length of any attribute exceeds this value, it will be truncated when the event is retrieved. The default value is <code>65536</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.concurrent.merge.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Lucene creates several "segments" in an Index. These segments are periodically merged together in order to provide faster
	querying. This property specifies the maximum number of threads that are allowed to be used for <strong>each</strong> of the storage directories. The default value is <code>2</code>. For high throughput
	environments, it is advisable to set the number of index threads larger than the number of merge threads * the number of storage locations. For example, if there are 2 storage
	locations and the number of index threads is set to 8, then the number of merge threads should likely be less than 4. While it is not critical that this be done, setting the
	number of merge threads larger than this can result in all index threads being used to merge, which would cause the NiFi flow to periodically pause while indexing is happening,
	resulting in some data being processed with much higher latency than other data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.warm.cache.frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each time that a Provenance query is run, the query must first search the Apache Lucene indices (at least, in most cases - there are
	some queries that are run often and the results are cached to avoid searching the Lucene indices). When a Lucene index is opened for the first time, it can be very expensive and take
	several seconds. This is compounded by having many different indices, and can result in a Provenance query taking much longer. After the index has been opened, the Operating System&#8217;s
	disk cache will typically hold onto enough data to make re-opening the index much faster - at least for a period of time, until the disk cache evicts this data. If this value is set,
	NiFi will periodically open each Lucene index and then close it, in order to "warm" the cache. This will result in far faster queries when the Provenance Repository is large. As with
	all great things, though, it comes with a cost. Warming the cache does take some CPU resources, but more importantly it will evict other data from the Operating System disk cache and
	will result in reading (potentially a great deal of) data from the disk. This can result in lower NiFi performance. However, if NiFi is running in an environment where CPU and disk
	are not fully utilized, this feature can result in far faster Provenance queries. The default value for this property is blank (i.e. disabled).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="encrypted-write-ahead-provenance-repository-properties"><a class="anchor" href="#encrypted-write-ahead-provenance-repository-properties"></a>Encrypted Write Ahead Provenance Repository Properties</h3>
<div class="paragraph">
<p>All of the properties defined above (see <a href="#write-ahead-provenance-repository-properties">Write Ahead Repository Properties</a>) still apply. Only encryption-specific properties are listed here. See <a href="user-guide.html#encrypted-provenance">Encrypted Provenance Repository in the User Guide</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.debug.frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the number of events processed between DEBUG statements documenting the performance metrics of the repository. This value is only used when DEBUG level statements are enabled in the log configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.encryption.key.provider.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the fully-qualified class name of the <strong>key provider</strong>. A key provider is the datastore interface for accessing the encryption key to protect the provenance events. There are currently two implementations&#8201;&#8212;&#8201;<code>StaticKeyProvider</code> which reads a key directly from <code>nifi.properties</code>, and <code>FileBasedKeyProvider</code> which reads <strong>n</strong> many keys from an encrypted file. The interface is extensible, and HSM-backed or other providers are expected in the future.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.encryption.key.provider.location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to the key definition resource (empty for <code>StaticKeyProvider</code>, <code>./keys.nkp</code> or similar path for <code>FileBasedKeyProvider</code>). For future providers like an HSM, this may be a connection string or URL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.encryption.key.id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The active key ID to use for encryption (e.g. <code>Key1</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.encryption.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key to use for <code>StaticKeyProvider</code>. The key format is hex-encoded (<code>0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210</code>) but can also be encrypted using the <a href="#encrypt-config_tool"><code>./encrypt-config.sh</code></a> tool in NiFi Toolkit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.provenance.repository.encryption.key.id.*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows for additional keys to be specified for the <code>StaticKeyProvider</code>. For example, the line <code>nifi.provenance.repository.encryption.key.id.Key2=012...210</code> would provide an available key <code>Key2</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The simplest configuration is below:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>nifi.provenance.repository.implementation=org.apache.nifi.provenance.EncryptedWriteAheadProvenanceRepository
nifi.provenance.repository.debug.frequency=100
nifi.provenance.repository.encryption.key.provider.implementation=org.apache.nifi.provenance.StaticKeyProvider
nifi.provenance.repository.encryption.key.provider.location=
nifi.provenance.repository.encryption.key.id=Key1
nifi.provenance.repository.encryption.key=0123456789ABCDEFFEDCBA98765432100123456789ABCDEFFEDCBA9876543210</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="component-status-repository"><a class="anchor" href="#component-status-repository"></a>Component Status Repository</h3>
<div class="paragraph">
<p>The Component Status Repository contains the information for the Component Status History tool in the User Interface. These
properties govern how that tool works.</p>
</div>
<div class="paragraph">
<p>The buffer.size and snapshot.frequency work together to determine the amount of historical data to retain. As an example to
configure two days worth of historical data with a data point snapshot occurring every 5 minutes you would configure
snapshot.frequency to be "5 mins" and the buffer.size to be "576". To further explain this example for every 60 minutes there
are 12 (60 / 5) snapshot windows for that time period. To keep that data for 48 hours (12 * 48) you end up with a buffer size
of 576.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.components.status.repository.implementation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Component Status Repository implementation. The default value is <code>org.apache.nifi.controller.status.history.VolatileComponentStatusRepository</code> and should not be changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.components.status.repository.buffer.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the buffer size for the Component Status Repository. The default value is <code>1440</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.components.status.snapshot.frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value indicates how often to present a snapshot of the components' status history. The default value is <code>1 min</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="site_to_site_properties"><a class="anchor" href="#site_to_site_properties"></a>Site to Site Properties</h3>
<div class="paragraph">
<p>These properties govern how this instance of NiFi communicates with remote instances of NiFi when Remote Process Groups are configured in the dataflow.
Remote Process Groups can choose transport protocol from RAW and HTTP. Properties named with <em>nifi.remote.input.socket.*</em> are RAW transport protocol specific. Similarly, <em>nifi.remote.input.http.*</em> are HTTP transport protocol specific properties.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.remote.input.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host name that will be given out to clients to connect to this NiFi instance for Site-to-Site communication. By default, it is the value from InetAddress.getLocalHost().getHostName(). On UNIX-like operating systems, this is typically the output from the <code>hostname</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.remote.input.secure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates whether communication between this instance of NiFi and remote NiFi instances should be secure. By default, it is set to <code>false</code>. In order for secure site-to-site to work, set the property to <code>true</code>.   Many other Security Properties (below) must also be configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.remote.input.socket.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The remote input socket port for Site-to-Site communication. By default, it is blank, but it must have a value in order to use RAW socket as transport protocol for Site-to-Site.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.remote.input.http.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether HTTP Site-to-Site should be enabled on this host.  By default, it is set to <code>true</code>.<br>
Whether a Site-to-Site client uses HTTP or HTTPS is determined by <code>nifi.remote.input.secure</code>. If it is set to <code>true</code>, then requests are sent as HTTPS to <code>nifi.web.https.port</code>. If set to <code>false</code>, HTTP requests are sent to <code>nifi.web.http.port</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.remote.input.http.transaction.ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how long a transaction can stay alive on the server.  By default, it is set to <code>30 secs</code>.<br>
If a Site-to-Site client hasn’t proceeded to the next action after this period of time, the transaction is discarded from the remote NiFi instance. For example, when a client creates a transaction but doesn’t send or receive flow files, or when a client sends or receives flow files but doesn’t confirm that transaction.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="web-properties"><a class="anchor" href="#web-properties"></a>Web Properties</h3>
<div class="paragraph">
<p>These properties pertain to the web-based User Interface.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.war.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the location of the web war directory. The default value is <code>./lib</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.http.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP host. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.http.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTP port. The default value is <code>8080</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.http.port.forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port which forwards incoming HTTP requests to <code>nifi.web.http.host</code>. This property is designed to be used with <em>port forwarding</em>, when NiFi has to be started by a non-root user for better security, yet it needs to be accessed via low port to go through a firewall. For example, to expose NiFi via HTTP protocol on port 80, but actually listening on port 8080, you need to configure OS level port forwarding such as <code>iptables</code> (Linux/Unix) or <code>pfctl</code> (OS X) that redirects requests from 80 to 8080. Then set <code>nifi.web.http.port</code> as 8080, and <code>nifi.web.http.port.forwarding</code> as 80. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.http.network.interface*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the network interface to which NiFi should bind for HTTP requests. It is blank by default.<br>
<br>
<strong>NOTE</strong>: Multiple network interfaces can be specified by using the <strong><em>nifi.web.http.network.interface.</em></strong> prefix with unique suffixes and separate network interface names as values.<br>
<br>
For example, to provide two additional network interfaces, a user could also specify additional properties with keys of:<br>
<br>
nifi.web.http.network.interface.eth0=eth0<br>
nifi.web.http.network.interface.eth1=eth1<br>
<br>
Providing three total network interfaces, including  <code>nifi.web.http.network.interface.default</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.https.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTPS host. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.https.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The HTTPS port. It is blank by default. When configuring NiFi to run securely, this port should be configured.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.https.port.forwarding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>nifi.web.http.port.forwarding</code>, but with HTTPS for secure communication. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.https.network.interface*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the network interface to which NiFi should bind for HTTPS requests. It is blank by default.<br>
<br>
<strong>NOTE</strong>: Multiple network interfaces can be specified by using the <strong><em>nifi.web.https.network.interface.</em></strong> prefix with unique suffixes and separate network interface names as values.<br>
<br>
For example, to provide two additional network interfaces, a user could also specify additional properties with keys of:<br>
<br>
nifi.web.https.network.interface.eth0=eth0<br>
nifi.web.https.network.interface.eth1=eth1<br>
<br>
Providing three total network interfaces, including  <code>nifi.web.https.network.interface.default</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.jetty.working.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the Jetty working directory. The default value is <code>./work/jetty</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.web.jetty.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of Jetty threads. The default value is <code>200</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="security-properties"><a class="anchor" href="#security-properties"></a>Security Properties</h3>
<div class="paragraph">
<p>These properties pertain to various security features in NiFi. Many of these properties are covered in more detail in the
Security Configuration section of this Administrator&#8217;s Guide.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.sensitive.props.key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the password used to encrypt any sensitive property values that are configured in processors. By default, it is blank, but the system administrator should provide a value for it. It can be a string of any length, although the recommended minimum length is 10 characters. Be aware that once this password is set and one or more sensitive processor properties have been configured, this password should not be changed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.sensitive.props.algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The algorithm used to encrypt sensitive properties. The default value is <code>PBEWITHMD5AND256BITAES-CBC-OPENSSL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.sensitive.props.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The sensitive property provider. The default value is <code>BC</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.sensitive.props.additional.keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The comma separated list of properties to encrypt in addition to the default sensitive properties (see <a href="#encrypt-config_tool">Encrypt-Config Tool</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.keystore*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full path and name of the keystore. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.keystoreType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keystore type. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.keystorePasswd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The keystore password. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.keyPasswd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key password. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.truststore*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full path and name of the truststore. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.truststoreType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The truststore type. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.truststorePasswd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The truststore password. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.needClientAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates whether client authentication in the cluster protocol. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.user.authorizer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies which of the configured Authorizers in the authorizers.xml file to use.  By default, it is set to <code>file-provider</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.user.login.identity.provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates what type of login identity provider to use. The default value is blank, can be set to the identifier from a provider
in the file specified in <code>nifi.login.identity.provider.configuration.file</code>. Setting this property will trigger NiFi to support username/password authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.ocsp.responder.url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the URL for the Online Certificate Status Protocol (OCSP) responder if one is being used. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.security.ocsp.responder.certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the location of the OCSP responder certificate if one is being used. It is blank by default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="identity-mapping-properties"><a class="anchor" href="#identity-mapping-properties"></a>Identity Mapping Properties</h3>
<div class="paragraph">
<p>These properties can be utilized to normalize user identities.  When implemented, identities authenticated by different identity providers (certificates, LDAP, Kerberos) are treated the same internally in NiFi.  As a result, duplicate users are avoided and user-specific configurations such as authorizations only need to be setup once per user.</p>
</div>
<div class="paragraph">
<p>The following examples demonstrate normalizing DNs from certificates and principals from Kerberos:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>nifi.security.identity.mapping.pattern.dn=^CN=(.*?), OU=(.*?), O=(.*?), L=(.*?), ST=(.*?), C=(.*?)$
nifi.security.identity.mapping.value.dn=$1@$2
nifi.security.identity.mapping.pattern.kerb=^(.*?)/instance@(.*?)$
nifi.security.identity.mapping.value.kerb=$1@$2</pre>
</div>
</div>
<div class="paragraph">
<p>The last segment of each property is an identifier used to associate the pattern with the replacement value.  When a user makes a request to NiFi, their identity is checked to see if it matches each of those patterns in lexicographical order.  For the first one that matches, the replacement specified in the <code>nifi.security.identity.mapping.value.xxxx</code> property is used. So a login with <code>CN=localhost, OU=Apache NiFi, O=Apache, L=Santa Monica, ST=CA, C=US</code> matches the DN mapping pattern above and the DN mapping value <code>$1@$2</code> is applied.  The user is normalized to <code>localhost@Apache NiFi</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These mappings are also applied to the "Initial Admin Identity" and "Cluster Node Identity" properties in the authorizers.xml file (See <a href="#authorizers-setup">Authorizers.xml Setup</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cluster-common-properties"><a class="anchor" href="#cluster-common-properties"></a>Cluster Common Properties</h3>
<div class="paragraph">
<p>When setting up a NiFi cluster, these properties should be configured the same way on all nodes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.protocol.heartbeat.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval at which nodes should emit heartbeats to the Cluster Coordinator. The default value is <code>5 sec</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.protocol.is.secure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates whether cluster communications are secure. The default value is <code>false</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="cluster-node-properties"><a class="anchor" href="#cluster-node-properties"></a>Cluster Node Properties</h3>
<div class="paragraph">
<p>Configure these properties for cluster nodes.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.is.node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set this to <code>true</code> if the instance is a node in a cluster. The default value is <code>false</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified address of the node. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.protocol.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The node&#8217;s protocol port. It is blank by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.protocol.threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads that should be used to communicate with other nodes
in the cluster. This property defaults to <code>10</code>, but for large clusters, this value may need to be larger.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.event.history.size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When the state of a node in the cluster is changed, an event is generated
and can be viewed in the Cluster page. This value indicates how many events to keep in memory for each node. The default value is <code>25</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.connection.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When connecting to another node in the cluster, specifies how long this node should wait before considering
the connection a failure. The default value is <code>5 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.node.read.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When communicating with another node in the cluster, specifies how long this node should wait to receive information
from the remote node before considering the communication with the node a failure. The default value is <code>5 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.firewall.file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the node firewall file. This is a file that may be used to list all the nodes that are allowed to connect
to the cluster. It provides an additional layer of security. This value is blank by default, meaning that no firewall file is to be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.flow.election.max.wait.time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the amount of time to wait before electing a Flow as the "correct" Flow. If the number of Nodes that have voted is equal to the number specified by the <code>nifi.cluster.flow.election.max.candidates</code> property, the cluster will not wait this long. The default value is <code>5 mins</code>. Note that the time starts as soon as the first vote is cast.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.flow.election.max.candidates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of Nodes required in the cluster to cause early election of Flows. This allows the Nodes in the cluster to avoid having to wait a long time before starting processing if we reach at least this number of nodes in the cluster.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="claim_management"><a class="anchor" href="#claim_management"></a>Claim Management</h3>
<div class="paragraph">
<p>Whenever a request is made to change the dataflow, it is important that
all nodes in the NiFi cluster are kept in-sync. In order to allow for this, NiFi employs a two-phase commit. The request
is first replicated to all nodes in the cluster, simply asking whether or not the request is allowed. Each node then determines
whether or not it will allow the request and if so issues a "Claim" on the component(s) being modified. This claim can be
thought of as a mutually-exclusive lock that is owned by the requestor. Once all nodes have voted on whether or not the request
is allowed, the node from which the request originated must decide whether or not to complete the request. If any node voted
<em>NO</em> then the request is canceled and the Claim is canceled with an error message sent back to the user. However, if the nodes
all vote <em>YES</em> then the request is completed. In this sort of distributed environment, it is possible that the node that
made the original request will fail after the voting has occurred and before the request was completed. This would leave
the component locked indefinitely so that no more changes can be made to the component. In order to avoid this, the Claim
will time out after some period of time. These properties determines how these locks are managed.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.cluster.request.replication.claim.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies how long to wait before considering a lock <em>expired</em> and automatically
unlocking.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="zookeeper-properties"><a class="anchor" href="#zookeeper-properties"></a>ZooKeeper Properties</h3>
<div class="paragraph">
<p>NiFi depends on Apache ZooKeeper for determining which node in the cluster should play the role of Primary Node
and which node should play the role of Cluster Coordinator. These properties must be configured in order for NiFi
to join a cluster.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.zookeeper.connect.string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Connect String that is needed to connect to Apache ZooKeeper. This is a comma-separated list
of hostname:port pairs. For example, <code>localhost:2181,localhost:2182,localhost:2183</code>. This should contain a list of all ZooKeeper
instances in the ZooKeeper quorum. This property must be specified to join a cluster and has no default value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.zookeeper.connect.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long to wait when connecting to ZooKeeper before considering the connection a failure. The default value is <code>3 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.zookeeper.session.timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long to wait after losing a connection to ZooKeeper before the session is expired. The default value is <code>3 secs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.zookeeper.root.node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The root ZNode that should be used in ZooKeeper. ZooKeeper provides a directory-like structure
for storing data. Each <em>directory</em> in this structure is referred to as a ZNode. This denotes the root ZNode, or <em>directory</em>,
that should be used for storing data. The default value is <code>/root</code>. This is important to set correctly, as which cluster
the NiFi instance attempts to join is determined by which ZooKeeper instance it connects to and the ZooKeeper Root Node
that is specified.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="kerberos_properties"><a class="anchor" href="#kerberos_properties"></a>Kerberos Properties</h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.krb5.file*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the krb5 file, if used. It is blank by default. At this time, only a single krb5 file is allowed to
    be specified per NiFi instance, so this property is configured here to support SPNEGO and service principals rather than in individual Processors.
    If necessary the krb5 file can support multiple realms.
    Example: <code>/etc/krb5.conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.service.principal*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the NiFi Kerberos service principal, if used. It is blank by default. Note that this property is for NiFi to authenticate as a client other systems.
   Example: <code>nifi/nifi.example.com</code> or <code>nifi/nifi.example.com@EXAMPLE.COM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.service.keytab.location*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file path of the NiFi Kerberos keytab, if used. It is blank by default. Note that this property is for NiFi to authenticate as a client other systems.
  Example: <code>/etc/nifi.keytab</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.spnego.principal*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the NiFi Kerberos service principal, if used. It is blank by default. Note that this property is used to authenticate NiFi users.
   Example: <code>HTTP/nifi.example.com</code> or <code>HTTP/nifi.example.com@EXAMPLE.COM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.spnego.keytab.location*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file path of the NiFi Kerberos keytab, if used. It is blank by default. Note that this property is used to authenticate NiFi users.
  Example: <code>/etc/http-nifi.keytab</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.kerberos.spengo.authentication.expiration*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The expiration duration of a successful Kerberos user authentication, if used. The default value is <code>12 hours</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="custom_properties"><a class="anchor" href="#custom_properties"></a>Custom Properties</h3>
<div class="paragraph">
<p>To configure custom properties for use with NiFi’s Expression Language:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the custom property. Ensure that:</p>
<div class="ulist">
<ul>
<li>
<p>Each custom property contains a distinct property value, so that it is not overridden by existing environment properties, system properties, or FlowFile attributes.</p>
</li>
<li>
<p>Each node in a clustered environment is configured with the same custom properties.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Update the <em>nifi.properties</em> file with the location of the custom property files.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nifi.variable.registry.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a comma-separated list of file location paths for one or more custom property files.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>For Upgrading</strong> - Take care when configuring the properties above that are marked with an asterisk (*). To make the upgrade process easier, it is advisable to change the default configurations to locations outside the main root installation directory. In this way, these items can remain in their configured location through an upgrade, and NiFi can find all the repositories and configuration files and pick up where it left off as soon as the old version is stopped and the new version is started. Furthermore, the administrator may reuse this <em>nifi.properties</em> file and any other configuration files without having to re-configure them each time an upgrade takes place. As previously noted, it is important to check for any changes in the <em>nifi.properties</em> file of the new version when upgrading and make sure they are reflected in the <em>nifi.properties</em> file you use.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-06-05 12:20:15 -04:00
</div>
</div>
</body>
</html>